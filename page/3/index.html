<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="http://yoursite.com">
  <title>Marnner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Just do it">
<meta property="og:type" content="website">
<meta property="og:title" content="Marnner">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="Marnner">
<meta property="og:description" content="Just do it">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Marnner">
<meta name="twitter:description" content="Just do it">
  
    <link rel="alternative" href="/atom.xml" title="Marnner" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" type="text/css" href="/./main.ea2298.css">
  <style type="text/css">
  
    #container.show {
      background: linear-gradient(200deg,#a0cfe4,#e8c37e);
    }
  </style>
  

  

</head>

<body>
  <div id="container" q-class="show:isCtnShow">
    <canvas id="anm-canvas" class="anm-canvas"></canvas>
    <div class="left-col" q-class="show:isShow">
      
<div class="overlay" style="background: #4d4d4d"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src="/img/avatar.jpg" class="js-avatar">
		</a>
		<hgroup>
		  <h1 class="header-author"><a href="/">marnner</a></h1>
		</hgroup>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/tags/随笔/">随笔</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
    		
    			
    			<a q-on="click: openSlider(e, 'innerArchive')" href="javascript:void(0)">所有文章</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'friends')" href="javascript:void(0)">友链</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'aboutme')" href="javascript:void(0)">关于我</a>
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/Maneng" title="github"><i class="icon-github"></i></a>
		        
					<a class="qq" target="_blank" href="/643449856" title="qq"><i class="icon-qq"></i></a>
		        
					<a class="weixin" target="_blank" href="/silencevva" title="weixin"><i class="icon-weixin"></i></a>
		        
					<a class="mail" target="_blank" href="mailto:marnner@qq.com" title="mail"><i class="icon-mail"></i></a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse">
      
<nav id="mobile-nav">
  	<div class="overlay js-overlay" style="background: #4d4d4d"></div>
	<div class="btnctn js-mobile-btnctn">
  		<div class="slider-trigger list" q-on="click: openSlider(e)"><i class="icon icon-sort"></i></div>
	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="/img/avatar.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author js-header-author">marnner</h1>
			</hgroup>
			
			
			
				
			
				
			
			
			
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/Maneng" title="github"><i class="icon-github"></i></a>
			        
						<a class="qq" target="_blank" href="/643449856" title="qq"><i class="icon-qq"></i></a>
			        
						<a class="weixin" target="_blank" href="/silencevva" title="weixin"><i class="icon-weixin"></i></a>
			        
						<a class="mail" target="_blank" href="mailto:marnner@qq.com" title="mail"><i class="icon-mail"></i></a>
			        
				</div>
			</nav>

			<nav class="header-menu js-header-menu">
				<ul style="width: 50%">
				
				
					<li style="width: 50%"><a href="/">主页</a></li>
		        
					<li style="width: 50%"><a href="/tags/随笔/">随笔</a></li>
		        
				</ul>
			</nav>
		</header>				
	</div>
	<div class="mobile-mask" style="display:none" q-show="isShow"></div>
</nav>

      <div id="wrapper" class="body-wrap">
        <div class="menu-l">
          <div class="canvas-wrap">
            <canvas data-colors="#eaeaea" data-sectionHeight="100" data-contentId="js-content" id="myCanvas1" class="anm-canvas"></canvas>
          </div>
          <div id="js-content" class="content-ll">
            
  
    <article id="post-An Intro to the Spring DispatcherServlet" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/23/An Intro to the Spring DispatcherServlet/">An Intro to the Spring DispatcherServlet</a>
    </h1>
  

        
        <a href="/2017/06/23/An Intro to the Spring DispatcherServlet/" class="archive-article-date">
  	<time datetime="2017-06-23T01:33:23.838Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-06-23</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a><strong>1. Introduction</strong></h1><p>简单地说，在前端控制器设计模式中，单个控制器负责将传入的HttpRequest引导到所有应用程序的其他控制器和处理程序。</p>
<p>Spring的DispatcherServlet实现了这种模式，因此负责正确地协调HttpRequests到他们的右边处理程序。</p>
<p>在本文中，我们将检查Spring DispatcherServlet的请求处理工作流程以及如何实现参与此工作流程的多个接口。</p>
<h1 id="2-DispatcherServlet-Request-Processing"><a href="#2-DispatcherServlet-Request-Processing" class="headerlink" title="2. DispatcherServlet Request Processing"></a><strong>2. DispatcherServlet Request Processing</strong></h1><p>DispatcherServlet本质上处理传入的HttpRequest，委托请求，并根据在Spring应用程序中实现的配置的HandlerAdapter接口以及指定处理程序，控制器端点和响应对象的附注进行处理。</p>
<p>让我们深入了解DispatcherServlet如何处理组件：</p>
<ul>
<li>在DispatcherServlet.WEB_APPLICATION_CONTEXT_ATTRIBUTE下关联到DispatcherServlet的WebApplicationContext被搜索并提供给进程的所有元素</li>
<li>DispatcherServlet发现使用getHandler（）为您的调度程序配置的HandlerAdapter接口的所有实现 - 每个发现和配置的实现都通过handle（）方法通过该进程的其余部分来处理请求</li>
<li>LocaleResolver可选地绑定到请求，以使进程中的元素能够解析该区域设置</li>
<li>ThemeResolver可选地绑定到请求，让元素（如视图）确定要使用哪个主题</li>
<li>如果指定了MultipartResolver，则会为MultipartFiles检查该请求 - 任何找到的都包含在MultipartHttpServletRequest中以进一步处理</li>
<li>在WebApplicationContext中声明的HandlerExceptionResolver实现在处理请求期间提取异常</li>
</ul>
<h1 id="3-HandlerAdapter-Interfaces"><a href="#3-HandlerAdapter-Interfaces" class="headerlink" title="3. HandlerAdapter Interfaces"></a><strong>3. HandlerAdapter Interfaces</strong></h1><p>HandlerAdapter接口有助于通过几个特定接口使用控制器，servlet，HttpRequests和HTTP路径。 HandlerAdapter接口因此通过DispatcherServlet请求处理工作流程的许多阶段起着至关重要的作用</p>
<p>首先，每个HandlerAdapter实现都从调度器的getHandler（）方法放入HandlerExecutionChain中。然后，随着执行链的进行，这些实现中的每个实现都会处理（）HttpServletRequest对象。</p>
<p>在以下部分中，我们将更详细地探讨一些最重要和最常用的HandlerAdapter。</p>
<h2 id="3-1-Mappings"><a href="#3-1-Mappings" class="headerlink" title="3.1. Mappings"></a><strong>3.1. Mappings</strong></h2><p>要了解映射，我们需要先看看如何注释控制器，因为控制器对于HandlerMapping接口是至关重要的。</p>
<p>SimpleControllerHandlerAdapter允许在没有@Controller注释的情况下显式地实现控制器。</p>
<p>RequestMappingHandlerAdapter支持使用@RequestMapping注释注释的方法。 我们将在此处关注@Controller注释，但是也可以使用一些有用的资源，并使用SimpleControllerHandlerAdapter的几个示例。</p>
<p>@RequestMapping注释设置与它相关联的WebApplicationContext中处理程序可用的特定端点。</p>
<p>我们来看一个公开和处理’/ user / example’端点的控制器的例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Controller</span></div><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/user"</span>)</div><div class="line"><span class="meta">@ResponseBody</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</div><div class="line">  </div><div class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/example"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">fetchUserExample</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// ...</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>由@RequestMapping注释指定的路径通过HandlerMapping接口在内部进行管理。</p>
<p>RL结构自然相对于DispatcherServlet本身，并由servlet映射确定。<br>因此，如果DispatcherServlet映射到“/”，则所有映射将被该映射覆盖。 但是，如果servlet映射是’/ dispatcher’，那么任何@RequestMapping注释都将与该根URL相关。</p>
<p>记住’/‘与servlet映射的’/ *’不一样！ ‘/‘是默认映射，并将所有URL公开给调度员的责任区域。</p>
<p>‘/ *’让许多较新的Spring开发者感到困惑。它没有指定具有相同URL上下文的所有路径都属于调度员的责任区域。相反，它会覆盖并忽略其他调度器映射。所以’/ example’将会成为404！</p>
<p>因此，除非非常有限的情况（如配置过滤器），否则不应使用’/ *’。</p>
<h2 id="3-2-HTTP-Request-Handling"><a href="#3-2-HTTP-Request-Handling" class="headerlink" title="3.2. HTTP Request Handling"></a><strong>3.2. HTTP Request Handling</strong></h2><p>DispatcherServlet的核心职责是将传入的HttpRequests发送到使用@Controller或@RestController注释指定的正确处理程序。</p>
<p>作为旁注，@Controller和@RestController的主要区别是如何生成响应 - @RestController默认定义了@ResponseBody。</p>
<p>在这里我们可以找到关于Spring控制器的更深入的写作。</p>
<h2 id="3-3-The-ViewResolver-Interface"><a href="#3-3-The-ViewResolver-Interface" class="headerlink" title="3.3. The ViewResolver Interface"></a><strong>3.3. The ViewResolver Interface</strong></h2><p>ViewResolver作为ApplicationContext对象上的配置设置附加到DispatcherServlet。 ViewResolver确定调度员提供什么样的视图以及从哪里提供的视图。</p>
<p>以下是我们将放入WebMvcConfigurerAdapter中以呈现JSP页面的示例配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="meta">@EnableWebMvc</span></div><div class="line"><span class="meta">@ComponentScan</span>(<span class="string">"com.baeldung.springdispatcherservlet"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="function"><span class="keyword">public</span> UrlBasedViewResolver <span class="title">viewResolver</span><span class="params">()</span> </span>&#123;</div><div class="line">        UrlBasedViewResolver resolver</div><div class="line">          = <span class="keyword">new</span> UrlBasedViewResolver();</div><div class="line">        resolver.setPrefix(<span class="string">"/WEB-INF/jsp/"</span>);</div><div class="line">        resolver.setSuffix(<span class="string">".jsp"</span>);</div><div class="line">        resolver.setViewClass(JstlView.class);</div><div class="line">        <span class="keyword">return</span> resolver;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>一个常见的问题是调度员的ViewResolver和整个项目目录结构的关联程度。我们来看看基础知识。</p>
<p>以下是使用Spring的XML配置的InternalViewResolver的示例路径配置：</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;property <span class="attr">name="prefix"</span> <span class="attr">value="/jsp/"/&gt;</span></div></pre></td></tr></table></figure>
<p>为了我们的例子，我们假设我们的应用程序正在托管在：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">http:</span><span class="comment">//localhost:8080/</span></div></pre></td></tr></table></figure>
<p>这是本地托管的Apache Tomcat服务器的默认地址和端口。 假设我们的应用程序称为dispatcherexample-1.0.0，我们的JSP视图将可以从以下位置访问：</p>
<blockquote>
<p><a href="http://localhost:8080/dispatcherexample-1.0.0/jsp/" target="_blank" rel="external">http://localhost:8080/dispatcherexample-1.0.0/jsp/</a></p>
</blockquote>
<p>在Maven的普通Spring项目中，这些视图的路径是：</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">src -<span class="string">|</span></div><div class="line">     main -<span class="string">|</span></div><div class="line">            java</div><div class="line">            resources</div><div class="line">            webapp -<span class="string">|</span></div><div class="line">                    jsp</div><div class="line">                    WEB-INF</div></pre></td></tr></table></figure>
<p>视图的默认位置在WEB-INF中。在上面的代码段中为我们的InternalViewResolver指定的路径确定了您的视图可用的“src / main / webapp”的子目录。</p>
<h2 id="3-6-The-MultipartResolver-Interface"><a href="#3-6-The-MultipartResolver-Interface" class="headerlink" title="3.6. The MultipartResolver Interface"></a><strong>3.6. The MultipartResolver Interface</strong></h2><p>MultipartResolver实现检查多部分的请求，并将它们包装在MultipartHttpServletRequest中，以便在发现至少一个multipart的过程中进一步处理其他元素。添加到AppConfig：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Bean</span></div><div class="line"><span class="function"><span class="keyword">public</span> CommonsMultipartResolver <span class="title">multipartResolver</span><span class="params">()</span> </span></div><div class="line">  <span class="keyword">throws</span> IOException &#123;</div><div class="line">    CommonsMultipartResolver resolver</div><div class="line">      = <span class="keyword">new</span> CommonsMultipartResolver();</div><div class="line">    resolver.setMaxUploadSize(<span class="number">10000000</span>);</div><div class="line">    <span class="keyword">return</span> resolver;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在我们已经配置了MultipartResolver bean，我们设置一个控制器来处理MultipartFile请求：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Controller</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MultipartController</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    ServletContext context;</div><div class="line"> </div><div class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/upload"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">FileuploadController</span><span class="params">(</span></span></div><div class="line">      @RequestParam(<span class="string">"file"</span>) MultipartFile file) </div><div class="line">      <span class="keyword">throws</span> IOException &#123;</div><div class="line">        ModelAndView modelAndView = <span class="keyword">new</span> ModelAndView(<span class="string">"index"</span>);</div><div class="line">        InputStream in = file.getInputStream();</div><div class="line">        String path = <span class="keyword">new</span> File(<span class="string">"."</span>).getAbsolutePath();</div><div class="line">        FileOutputStream f = <span class="keyword">new</span> FileOutputStream(</div><div class="line">          path.substring(<span class="number">0</span>, path.length()-<span class="number">1</span>)</div><div class="line">          + <span class="string">"/uploads/"</span> + file.getOriginalFilename());</div><div class="line">        <span class="keyword">int</span> ch;</div><div class="line">        <span class="keyword">while</span> ((ch = in.read()) != -<span class="number">1</span>) &#123;</div><div class="line">            f.write(ch);</div><div class="line">        &#125;</div><div class="line">        f.flush();</div><div class="line">        f.close();</div><div class="line">        modelAndView.getModel()</div><div class="line">          .put(<span class="string">"message"</span>, <span class="string">"File uploaded successfully!"</span>);</div><div class="line">        <span class="keyword">return</span> modelAndView;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="3-7-The-HandlerExceptionResolver-Interface"><a href="#3-7-The-HandlerExceptionResolver-Interface" class="headerlink" title="3.7. The HandlerExceptionResolver Interface"></a><strong>3.7. The HandlerExceptionResolver Interface</strong></h2><p>Spring的HandlerExceptionResolver为整个Web应用程序，单个控制器或一组控制器提供统一的错误处理。</p>
<p>要提供应用程序范围的自定义异常处理，请创建一个使用@ControllerAdvice注释的类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@ControllerAdvice</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleGlobalExceptionHandler</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="meta">@ExceptionHandler</span></div><div class="line">    <span class="meta">@ResponseBody</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">handleExampleException</span><span class="params">(Exception e)</span> </span>&#123;</div><div class="line">        <span class="comment">// ...</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用@ExceptionHandler注释的类中的任何方法将在调度员的责任区域内的每个控制器上都可用。</p>
<p>DispatcherServlet的ApplicationContext中的HandlerExceptionResolver接口的实现可用于在使用@ExceptionHandler作为注释时拦截该调度程序的责任区域下的特定控制器，并将正确的类作为参数传入：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Controller</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FooController</span></span>&#123;</div><div class="line"> </div><div class="line">    <span class="meta">@ExceptionHandler</span>(&#123; CustomException1.class, CustomException2.class &#125;)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleException</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// ...</span></div><div class="line">    &#125;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果发生异常CustomException1或CustomException2，handleException（）方法现在将作为上述示例中的FooController的异常处理程序。 这是一篇关于Spring Web应用程序中的异常处理的文章。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">spring,springmvc</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/06/23/An Intro to the Spring DispatcherServlet/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-如何获取spring管理的所有的bean" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/23/如何获取spring管理的所有的bean/">How to Get All Spring-Managed Beans?</a>
    </h1>
  

        
        <a href="/2017/06/23/如何获取spring管理的所有的bean/" class="archive-article-date">
  	<time datetime="2017-06-23T01:33:03.228Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-06-23</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a><strong>1.概述</strong></h1><p>在本文中，我们将探讨如何使用容器显示所有Spring管理的不同的bean。</p>
<h1 id="2-The-IoC-Container"><a href="#2-The-IoC-Container" class="headerlink" title="2. The IoC Container"></a><strong>2. The IoC Container</strong></h1><p>一个bean是Spring管理的应用程序的基础;所有的bean都与IOC容器一起居住，IOC容器负责管理其生命周期。</p>
<p>我们可以通过两种方式获取此容器中所有bean的列表：</p>
<ul>
<li>使用ListableBeanFactory接口</li>
<li>使用 Spring Boot Actuator</li>
</ul>
<h1 id="3-Using-ListableBeanFactory-Interface"><a href="#3-Using-ListableBeanFactory-Interface" class="headerlink" title="3. Using ListableBeanFactory Interface"></a><strong>3. Using ListableBeanFactory Interface</strong></h1><p>ListableBeanFactory接口提供getBeanDefinitionNames（）方法，该方法返回此工厂中定义的所有bean的名称。<br>该接口由预先加载其bean定义以枚举其所有bean实例的所有bean工厂实现。<br>您可以在官方文档中找到所有已知子接口及其实现类的列表。<br>对于这个例子，我们将使用一个Spring引导应用程序。<br>首先，我们将创建一些Spring bean。我们来创建一个简单的Spring Controller FooController：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Controller</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FooController</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> FooService fooService;</div><div class="line">     </div><div class="line">    <span class="meta">@RequestMapping</span>(value=<span class="string">"/displayallbeans"</span>) </div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getHeaderAndBody</span><span class="params">(Map model)</span></span>&#123;</div><div class="line">        model.put(<span class="string">"header"</span>, fooService.getHeader());</div><div class="line">        model.put(<span class="string">"message"</span>, fooService.getBody());</div><div class="line">        <span class="keyword">return</span> <span class="string">"displayallbeans"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个Controller依赖于另一个Spring bean FooService：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Service</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FooService</span> </span>&#123;</div><div class="line">     </div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getHeader</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"Display All Beans"</span>;</div><div class="line">    &#125;</div><div class="line">     </div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getBody</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"This is a sample application that displays all beans "</span></div><div class="line">          + <span class="string">"in Spring IoC container using ListableBeanFactory interface "</span></div><div class="line">          + <span class="string">"and Spring Boot Actuators."</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>请注意，我们在这里创建了两个不同的bean：</p>
<ul>
<li>fooController</li>
<li>fooService</li>
</ul>
<p>在执行此应用程序时，我们将使用applicationContext对象并调用其getBeanDefinitionNames（）方法，该方法将返回我们的applicationContext容器中的所有bean：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@SpringBootApplication</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ApplicationContext applicationContext;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        applicationContext = SpringApplication.run(Application.class, args);</div><div class="line">        displayAllBeans();</div><div class="line">    &#125;</div><div class="line">     </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">displayAllBeans</span><span class="params">()</span> </span>&#123;</div><div class="line">        String[] allBeanNames = applicationContext.getBeanDefinitionNames();</div><div class="line">        <span class="keyword">for</span>(String beanName : allBeanNames) &#123;</div><div class="line">            System.out.println(beanName);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这将打印来自applicationContext容器的所有bean：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">fooController</div><div class="line">fooService</div><div class="line"><span class="comment">//other beans</span></div></pre></td></tr></table></figure>
<p>请注意，随着我们定义的bean，它还将记录在此容器中的所有其他bean。为了清楚起见，我们在这里省略了，因为它们有很多。</p>
<h1 id="4-Using-Spring-Boot-Actuator"><a href="#4-Using-Spring-Boot-Actuator" class="headerlink" title="4. Using Spring Boot Actuator"></a><strong>4. Using Spring Boot Actuator</strong></h1><p>Spring Boot Actuator功能提供端点，用于监视我们应用程序的统计信息。</p>
<p>它包括许多内置的端点，包括/ beans。这将显示我们应用程序中所有Spring管理bean的完整列表。您可以在官方文档中找到现有端点的完整列表。<br>现在我们将在我们的application.properties中配置我们的beans端点：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">endpoints<span class="selector-class">.beans</span><span class="selector-class">.id</span>=springbeans</div><div class="line">endpoints<span class="selector-class">.beans</span><span class="selector-class">.sensitive</span>=false</div></pre></td></tr></table></figure>
<p>在这里，我们正在设置bean端点的id。这个springbeans id现在将映射到一个URL，该URL将用于通过HTTP访问它。我们将敏感属性设置为false，以便我们可以在不进行身份验证的情况下访问它。如果我们只想要验证的用户查看数据，我们可以将其保留为默认值true。</p>
<p>现在，我们只需点击URL <code>http：// &lt;address&gt;：&lt;management-port&gt; / springbeans</code>。如果没有指定任何单独的管理端口，我们可以使用我们的默认服务器端口。这将返回显示Spring IoC容器中所有Bean的JSON响应：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">    &#123;</div><div class="line">        "context": "application:8080",</div><div class="line">        "parent": null,</div><div class="line">        "beans": [</div><div class="line">            &#123;</div><div class="line">                "bean": "fooController",</div><div class="line">                "aliases": [],</div><div class="line">                "scope": "singleton",</div><div class="line">                "type": "com.baeldung.displayallbeans.controller.FooController",</div><div class="line">                "resource": "file [E:/Workspace/tutorials-master/spring-boot/target</div><div class="line">                  /classes/com/baeldung/displayallbeans/controller/FooController.class]",</div><div class="line">                "dependencies": [</div><div class="line">                    "fooService"</div><div class="line">                ]</div><div class="line">            &#125;,</div><div class="line">            &#123;</div><div class="line">                "bean": "fooService",</div><div class="line">                "aliases": [],</div><div class="line">                "scope": "singleton",</div><div class="line">                "type": "com.baeldung.displayallbeans.service.FooService",</div><div class="line">                "resource": "file [E:/Workspace/tutorials-master/spring-boot/target/</div><div class="line">                  classes/com/baeldung/displayallbeans/service/FooService.class]",</div><div class="line">                "dependencies": []</div><div class="line">            &#125;,</div><div class="line">            // ...other beans</div><div class="line">        ]</div><div class="line">    &#125;</div><div class="line">]</div></pre></td></tr></table></figure>
<p>当然，这也包含许多其他豆类，它们位于同一个spring容器中，但是为了清楚起见，我们在这里省略了它们。</p>
<h1 id="5-Conclusion"><a href="#5-Conclusion" class="headerlink" title="5. Conclusion"></a><strong>5. Conclusion</strong></h1><p>在本文中，我们学习了如何使用ListableBeanFactory界面和Spring Boot Actuator在Spring IoC容器中显示所有bean。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">spring</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/06/23/如何获取spring管理的所有的bean/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-Spring RequestMapping" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/23/Spring RequestMapping/">Spring RequestMapping</a>
    </h1>
  

        
        <a href="/2017/06/23/Spring RequestMapping/" class="archive-article-date">
  	<time datetime="2017-06-23T01:32:07.306Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-06-23</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-Overview"><a href="#1-Overview" class="headerlink" title="1. Overview"></a><strong>1. Overview</strong></h2><p>在本文中，我们将重点介绍Spring MVC - @RequestMapping中的一个主要注释。 简单地说，注释用于将Web请求映射到Spring Controller方法。</p>
<h2 id="2-RequestMapping-Basics"><a href="#2-RequestMapping-Basics" class="headerlink" title="2. @RequestMapping Basics"></a><strong>2. @RequestMapping Basics</strong></h2><p>我们从一个简单的例子开始 - 将HTTP请求映射到使用一些基本条件的方法。</p>
<h3 id="2-1-RequestMapping-–-by-Path"><a href="#2-1-RequestMapping-–-by-Path" class="headerlink" title="2.1. @RequestMapping – by Path"></a><strong>2.1. @RequestMapping – by Path</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/ex/foos"</span>, method = RequestMethod.GET)</div><div class="line"><span class="meta">@ResponseBody</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getFoosBySimplePath</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"Get some Foos"</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>要使用简单的curl命令测试此映射，请运行：</p>
<p>curl -i <a href="http://localhost:8080/spring-rest/ex/foos" target="_blank" rel="external">http://localhost:8080/spring-rest/ex/foos</a></p>
<h3 id="2-2-RequestMapping-–-the-HTTP-Method"><a href="#2-2-RequestMapping-–-the-HTTP-Method" class="headerlink" title="2.2. @RequestMapping – the HTTP Method"></a><strong>2.2. @RequestMapping – the HTTP Method</strong></h3><p>HTTP方法参数没有默认值 - 所以如果我们没有指定值，它将映射到任何HTTP请求。</p>
<p>这是一个简单的例子，类似于上一个例子 - 但这次映射到一个HTTP POST请求：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/ex/foos"</span>, method = POST)</div><div class="line"><span class="meta">@ResponseBody</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">postFoos</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"Post some Foos"</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>通过curl命令测试POST：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -<span class="selector-tag">i</span> -X POST http:<span class="comment">//localhost:8080/spring-rest/ex/foos</span></div></pre></td></tr></table></figure>
<h2 id="3-RequestMapping-and-HTTP-Headers"><a href="#3-RequestMapping-and-HTTP-Headers" class="headerlink" title="3. RequestMapping and HTTP Headers"></a><strong>3. RequestMapping and HTTP Headers</strong></h2><h3 id="3-1-RequestMapping-with-the-headers-Attribute"><a href="#3-1-RequestMapping-with-the-headers-Attribute" class="headerlink" title="3.1. @RequestMapping with the headers Attribute"></a><strong>3.1. @RequestMapping with the headers Attribute</strong></h3><p>可以通过指定请求的标题来进一步缩小映射：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/ex/foos"</span>, headers = <span class="string">"key=val"</span>, method = GET)</div><div class="line"><span class="meta">@ResponseBody</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getFoosWithHeader</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"Get some Foos with Header"</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>甚至通过@RequestMapping的头属性的多个头文件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(</div><div class="line">  value = <span class="string">"/ex/foos"</span>, </div><div class="line">  headers = &#123; <span class="string">"key1=val1"</span>, <span class="string">"key2=val2"</span> &#125;, method = GET)</div><div class="line"><span class="meta">@ResponseBody</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getFoosWithHeaders</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"Get some Foos with Header"</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>要测试操作，我们将使用curl header 支持：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -<span class="selector-tag">i</span> -H <span class="string">"key:val"</span> http:<span class="comment">//localhost:8080/spring-rest/ex/foos</span></div></pre></td></tr></table></figure>
<p>请注意，对于用于分离头文件和头值的语法是一个冒号，与HTTP规范相同，而在Spring中则使用等号。</p>
<h3 id="3-2-RequestMapping-Consumes-and-Produces"><a href="#3-2-RequestMapping-Consumes-and-Produces" class="headerlink" title="3.2. @RequestMapping Consumes and Produces"></a><strong>3.2. @RequestMapping Consumes and Produces</strong></h3><p>映射由控制器方法生成的媒体类型值得特别注意 - 我们可以通过上面介绍的@RequestMapping头部属性来映射基于其Accept头部的请求：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(</div><div class="line">  value = <span class="string">"/ex/foos"</span>, </div><div class="line">  method = GET, </div><div class="line">  headers = <span class="string">"Accept=application/json"</span>)</div><div class="line"><span class="meta">@ResponseBody</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getFoosAsJsonFromBrowser</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"Get some Foos with Header Old"</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>用于定义Accept标头的这种匹配是灵活的 - 它使用contains而不是equals，因此下面的请求仍然会正确映射：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">curl -<span class="keyword">H</span> <span class="string">"Accept:application/json,text/html"</span></div><div class="line">  http:<span class="comment">//localhost:8080/spring-rest/ex/foos</span></div></pre></td></tr></table></figure>
<p>从Spring 3.1开始，@RequestMapping注释现在具有生产和消耗属性，特别是为此目的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(</div><div class="line">  value = <span class="string">"/ex/foos"</span>, </div><div class="line">  method = RequestMethod.GET, </div><div class="line">  produces = <span class="string">"application/json"</span></div><div class="line">)</div><div class="line"><span class="meta">@ResponseBody</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getFoosAsJsonFromREST</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"Get some Foos with Header New"</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>此外，具有headers属性的旧类型的映射将自动从Spring 3.1开始转换为新的生成机制，因此结果将相同。</p>
<p>相同的方式consumed ：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">curl -<span class="keyword">H</span> <span class="string">"Accept:application/json"</span></div><div class="line">  http:<span class="comment">//localhost:8080/spring-rest/ex/foos</span></div></pre></td></tr></table></figure>
<p>此外，还生成支持多个值：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(</div><div class="line">  value = <span class="string">"/ex/foos"</span>, </div><div class="line">  method = GET,</div><div class="line">  produces = &#123; <span class="string">"application/json"</span>, <span class="string">"application/xml"</span> &#125;</div><div class="line">)</div></pre></td></tr></table></figure>
<p>请记住，这些 - 旧的方式和指定accept标头的新方法基本上是一样的映射，所以Spring不会允许它们在一起使用 - 将这两个方法都激活会导致：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">Caused by: java.lang.IllegalStateException: Ambiguous mapping found. </div><div class="line">Cannot map <span class="string">'fooController'</span> bean method </div><div class="line">java.lang.String </div><div class="line">org.baeldung.spring.web.controller</div><div class="line">  .FooController.getFoosAsJsonFromREST()</div><div class="line">to </div><div class="line">&#123; [/ex/foos],</div><div class="line">  methods=[GET],params=[],headers=[],</div><div class="line">  consumes=[],produces=[application/json],custom=[]</div><div class="line">&#125;: </div><div class="line">There is already <span class="string">'fooController'</span> bean method</div><div class="line">java.lang.String </div><div class="line">org.baeldung.spring.web.controller</div><div class="line">  .FooController.getFoosAsJsonFromBrowser() </div><div class="line">mapped.</div></pre></td></tr></table></figure>
<p>关于新产品和消费机制的最后一个注释 - 这些行为与大多数其他注释的行为不同：当在类型级别指定时，方法级注释不补充，而是覆盖类型级别信息。</p>
<h2 id="4-RequestMapping-with-Path-Variables"><a href="#4-RequestMapping-with-Path-Variables" class="headerlink" title="4. RequestMapping with Path Variables"></a><strong>4. RequestMapping with Path Variables</strong></h2><p>映射URI的一部分可以通过@PathVariable注释绑定到变量。</p>
<h3 id="4-1-Single-PathVariable"><a href="#4-1-Single-PathVariable" class="headerlink" title="4.1. Single @PathVariable"></a><strong>4.1. Single @PathVariable</strong></h3><p>单个路径变量的简单示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/ex/foos/&#123;id&#125;"</span>, method = GET)</div><div class="line"><span class="meta">@ResponseBody</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getFoosBySimplePathWithPathVariable</span><span class="params">(</span></span></div><div class="line">  @PathVariable(<span class="string">"id"</span>) <span class="keyword">long</span> id) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"Get a specific Foo with id="</span> + id;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果方法参数的名称与路径变量的名称完全匹配，则可以使用无值的@PathVariable来简化此操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/ex/foos/&#123;id&#125;"</span>, method = GET)</div><div class="line"><span class="meta">@ResponseBody</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getFoosBySimplePathWithPathVariable</span><span class="params">(</span></span></div><div class="line">  @PathVariable String id) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"Get a specific Foo with id="</span> + id;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>请注意，@PathVariable受益于自动类型转换，因此我们也可以将该ID声明为：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@PathVariable <span class="keyword">long</span> <span class="keyword">id</span></div></pre></td></tr></table></figure>
<h3 id="4-2-Multiple-PathVariable"><a href="#4-2-Multiple-PathVariable" class="headerlink" title="4.2. Multiple @PathVariable"></a><strong>4.2. Multiple @PathVariable</strong></h3><p>更复杂的URI可能需要将URI的多个部分映射到多个值：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/ex/foos/&#123;fooid&#125;/bar/&#123;barid&#125;"</span>, method = GET)</div><div class="line"><span class="meta">@ResponseBody</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getFoosBySimplePathWithPathVariables</span></span></div><div class="line">  <span class="params">(@PathVariable <span class="keyword">long</span> fooid, @PathVariable <span class="keyword">long</span> barid)</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"Get a specific Bar with id="</span> + barid + </div><div class="line">      <span class="string">" from a Foo with id="</span> + fooid;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="4-3-PathVariable-with-RegEx"><a href="#4-3-PathVariable-with-RegEx" class="headerlink" title="4.3. @PathVariable with RegEx"></a><strong>4.3. @PathVariable with RegEx</strong></h3><p>映射@PathVariable时也可以使用正则表达式;例如，我们将把映射限制为仅接受id的数值：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/ex/bars/&#123;numericId:[\\d]+&#125;"</span>, method = GET)</div><div class="line"><span class="meta">@ResponseBody</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getBarsBySimplePathWithPathVariable</span><span class="params">(</span></span></div><div class="line">  @PathVariable <span class="keyword">long</span> numericId) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"Get a specific Bar with id="</span> + numericId;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这将意味着以下URI将匹配：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">http:</span>//localhost:<span class="number">8080</span>/spring-<span class="built_in">rest</span>/ex/bars/<span class="number">1</span></div></pre></td></tr></table></figure>
<p>但这不会匹配：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">http:</span>//localhost:<span class="number">8080</span>/spring-<span class="built_in">rest</span>/ex/bars/abc</div></pre></td></tr></table></figure>
<h2 id="5-RequestMapping-with-Request-Parameters"><a href="#5-RequestMapping-with-Request-Parameters" class="headerlink" title="5. RequestMapping with Request Parameters"></a><strong>5. RequestMapping with Request Parameters</strong></h2><p>@RequestMapping允许使用@RequestParam注释轻松映射URL参数。 我们现在正在将请求映射到URI，如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line">http:<span class="comment">//localhost:8080/spring-rest/ex/bars?id=100</span></div><div class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/ex/bars"</span>, method = GET)</div><div class="line"><span class="meta">@ResponseBody</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getBarBySimplePathWithRequestParam</span><span class="params">(</span></span></div><div class="line">  @RequestParam(<span class="string">"id"</span>) <span class="keyword">long</span> id) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"Get a specific Bar with id="</span> + id;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后我们使用控制器方法签名中的@RequestParam（“id”）注释来提取id参数的值</p>
<p>使用id参数发送请求，我们将在curl中使用参数支持：</p>
<blockquote>
<pre><code>curl -i -d id=100 http://localhost:8080/spring-rest/ex/bars
</code></pre></blockquote>
<p>在这个例子中，参数是直接绑定的，而不是先被声明。<br>对于更高级的场景，@RequestMapping可以可选地定义参数，这也是缩小请求映射的另一种方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/ex/bars"</span>, params = <span class="string">"id"</span>, method = GET)</div><div class="line"><span class="meta">@ResponseBody</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getBarBySimplePathWithExplicitRequestParam</span><span class="params">(</span></span></div><div class="line">  @RequestParam(<span class="string">"id"</span>) <span class="keyword">long</span> id) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"Get a specific Bar with id="</span> + id;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>允许更灵活的映射 - 可以设置多个参数值，并不需要全部使用它们：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(</div><div class="line">  value = <span class="string">"/ex/bars"</span>, </div><div class="line">  params = &#123; <span class="string">"id"</span>, <span class="string">"second"</span> &#125;, </div><div class="line">  method = GET)</div><div class="line"><span class="meta">@ResponseBody</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getBarBySimplePathWithExplicitRequestParams</span><span class="params">(</span></span></div><div class="line">  @RequestParam(<span class="string">"id"</span>) <span class="keyword">long</span> id) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"Narrow Get a specific Bar with id="</span> + id;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们可以这样请求URI：</p>
<blockquote>
<p><a href="http://localhost:8080/spring-rest/ex/bars?id=100&amp;second=something" target="_blank" rel="external">http://localhost:8080/spring-rest/ex/bars?id=100&amp;second=something</a></p>
</blockquote>
<p>将始终映射到最佳匹配 - 这是较精细的匹配，它定义了id和second参数。</p>
<h2 id="6-RequestMapping-Corner-Cases"><a href="#6-RequestMapping-Corner-Cases" class="headerlink" title="6. RequestMapping Corner Cases"></a><strong>6. RequestMapping Corner Cases</strong></h2><h3 id="6-1-RequestMapping-–-multiple-paths-mapped-to-the-same-controller-method"><a href="#6-1-RequestMapping-–-multiple-paths-mapped-to-the-same-controller-method" class="headerlink" title="6.1. @RequestMapping – multiple paths mapped to the same controller method"></a><strong>6.1. @RequestMapping – multiple paths mapped to the same controller method</strong></h3><p>虽然单个控制器方法通常使用一个@RequestMapping路径值，但这只是一个很好的做法，而不是一个很难和快速的规则 - 有些情况可能需要将多个请求映射到同一个方法。对于这种情况，@RequestMapping的value属性确实接受多个映射，而不仅仅是一个映射：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(</div><div class="line">  value = &#123; <span class="string">"/ex/advanced/bars"</span>, <span class="string">"/ex/advanced/foos"</span> &#125;, </div><div class="line">  method = GET)</div><div class="line"><span class="meta">@ResponseBody</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getFoosOrBarsByPath</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"Advanced - Get some Foos or Bars"</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在，这两个curl命令都应该使用相同的方法：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">curl -<span class="selector-tag">i</span> http:<span class="comment">//localhost:8080/spring-rest/ex/advanced/foos</span></div><div class="line">curl -<span class="selector-tag">i</span> http:<span class="comment">//localhost:8080/spring-rest/ex/advanced/bars</span></div></pre></td></tr></table></figure>
<h3 id="6-2-RequestMapping-–-multiple-HTTP-request-methods-to-the-same-controller-method"><a href="#6-2-RequestMapping-–-multiple-HTTP-request-methods-to-the-same-controller-method" class="headerlink" title="6.2. @RequestMapping – multiple HTTP request methods to the same controller method"></a><strong>6.2. @RequestMapping – multiple HTTP request methods to the same controller method</strong></h3><p>使用不同HTTP动词的多个请求可以映射到相同的控制器方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(</div><div class="line">  value = <span class="string">"/ex/foos/multiple"</span>, </div><div class="line">  method = &#123; RequestMethod.PUT, RequestMethod.POST &#125;</div><div class="line">)</div><div class="line"><span class="meta">@ResponseBody</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">putAndPostFoos</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"Advanced - PUT and POST within single method"</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用curl，这两个现在将访问同样的方法：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">curl -<span class="selector-tag">i</span> -X POST http:<span class="comment">//localhost:8080/spring-rest/ex/foos/multiple</span></div><div class="line">curl -<span class="selector-tag">i</span> -X PUT http:<span class="comment">//localhost:8080/spring-rest/ex/foos/multiple</span></div></pre></td></tr></table></figure>
<h3 id="6-3-RequestMapping-–-a-fallback-for-all-requests"><a href="#6-3-RequestMapping-–-a-fallback-for-all-requests" class="headerlink" title="6.3. @RequestMapping – a fallback for all requests"></a><strong>6.3. @RequestMapping – a fallback for all requests</strong></h3><p>要使用特定的HTTP方法为所有请求实现一个简单的回调 - 例如，对于GET：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"*"</span>, method = RequestMethod.GET)</div><div class="line"><span class="meta">@ResponseBody</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getFallback</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"Fallback for GET Requests"</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>甚至对于所有请求：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(</div><div class="line">  value = <span class="string">"*"</span>, </div><div class="line">  method = &#123; RequestMethod.GET, RequestMethod.POST ... &#125;)</div><div class="line"><span class="meta">@ResponseBody</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">allFallback</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"Fallback for All Requests"</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="7-New-Request-Mapping-Shortcuts"><a href="#7-New-Request-Mapping-Shortcuts" class="headerlink" title="7. New Request Mapping Shortcuts"></a><strong>7. New Request Mapping Shortcuts</strong></h2><p>在Spring Framework 4.3中引入了基于HTTP方法的@RequestMapping注释：</p>
<ul>
<li><strong>@GetMapping</strong></li>
<li><strong>@PostMapping</strong></li>
<li><strong>@PutMapping</strong></li>
<li><strong>@DeleteMapping</strong></li>
<li><strong>@PatchMapping</strong></li>
</ul>
<p>这些新的注释大大提高了可读性，并减少了代码的冗长度(verbosity )。我们通过创建一个支持CRUD操作的RESTful API来查看这些新的注释：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@GetMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</div><div class="line"><span class="keyword">public</span> ResponseEntity&lt;?&gt; getBazz(<span class="meta">@PathVariable</span> String id)&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(<span class="keyword">new</span> Bazz(id, <span class="string">"Bazz"</span>+id), HttpStatus.OK);</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="meta">@PostMapping</span></div><div class="line"><span class="keyword">public</span> ResponseEntity&lt;?&gt; newBazz(<span class="meta">@RequestParam</span>(<span class="string">"name"</span>) String name)&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(<span class="keyword">new</span> Bazz(<span class="string">"5"</span>, name), HttpStatus.OK);</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="meta">@PutMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</div><div class="line"><span class="keyword">public</span> ResponseEntity&lt;?&gt; updateBazz(</div><div class="line">  <span class="meta">@PathVariable</span> String id,</div><div class="line">  <span class="meta">@RequestParam</span>(<span class="string">"name"</span>) String name) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(<span class="keyword">new</span> Bazz(id, name), HttpStatus.OK);</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="meta">@DeleteMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</div><div class="line"><span class="keyword">public</span> ResponseEntity&lt;?&gt; deleteBazz(<span class="meta">@PathVariable</span> String id)&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(<span class="keyword">new</span> Bazz(id), HttpStatus.OK);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="8-Spring-Configuration"><a href="#8-Spring-Configuration" class="headerlink" title="8. Spring Configuration"></a><strong>8. Spring Configuration</strong></h2><p>Spring MVC配置很简单 - 考虑到我们的FooController在以下包中定义：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> org.baeldung.spring.web.controller;</div><div class="line"> </div><div class="line"><span class="meta">@Controller</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FooController</span> </span>&#123; ... &#125;</div></pre></td></tr></table></figure>
<p>我们只需要一个@Configuration类来启用完整的MVC支持，并为控制器配置类路径扫描：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="meta">@EnableWebMvc</span></div><div class="line"><span class="meta">@ComponentScan</span>(&#123; <span class="string">"org.baeldung.spring.web.controller"</span> &#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MvcConfig</span> </span>&#123;</div><div class="line">    <span class="comment">//</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="9-Conclusion"><a href="#9-Conclusion" class="headerlink" title="9. Conclusion"></a><strong>9. Conclusion</strong></h2><p>本文重点介绍Spring中的@RequestMapping注释 - 讨论一个简单的用例，HTTP头的映射，URI的部分绑定与@PathVariable绑定，并使用URI参数和@RequestParam注释。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">spring</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/06/23/Spring RequestMapping/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-Java Bean Validation Basics" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/23/Java Bean Validation Basics/">Java Bean Validation Basics</a>
    </h1>
  

        
        <a href="/2017/06/23/Java Bean Validation Basics/" class="archive-article-date">
  	<time datetime="2017-06-23T01:31:54.901Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-06-23</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-Overview"><a href="#1-Overview" class="headerlink" title="1. Overview"></a><strong>1. Overview</strong></h1><p>在这篇快速的文章中，我们将介绍使用标准框架（JSR 303和JSR 349）来验证Java bean的基础知识。</p>
<p>在大多数应用程序中验证用户输入当然是一个超常见的要求，Java Bean验证框架已成为处理这种逻辑的事实上的标准。</p>
<h1 id="2-JSR-303-and-JSR-349"><a href="#2-JSR-303-and-JSR-349" class="headerlink" title="2. JSR 303 and JSR 349"></a><strong>2. JSR 303 and JSR 349</strong></h1><p>JSR 303是用于bean验证的Java API的一个规范，它是JavaEE和JavaSE的一部分，它确保bean的属性符合特定标准，使用诸如@NotNull，@Min和@Max之类的注释。</p>
<p>JSR 349扩展了JSR 303，具有诸如约束冲突消息中的动态表达式评估，消息插入等功能。</p>
<p>有关规范的完整信息，请阅读JSR 303或JSR 349 JSR。</p>
<h1 id="3-Dependencies"><a href="#3-Dependencies" class="headerlink" title="3. Dependencies"></a><strong>3. Dependencies</strong></h1><p>我们将在这里使用Maven示例来显示确切的所需依赖关系，但是当然这些jar可以通过多种方式添加到项目中。</p>
<h3 id="3-1-Validation-API"><a href="#3-1-Validation-API" class="headerlink" title="3.1. Validation API"></a><strong>3.1. Validation API</strong></h3><p>根据规范JSR 303和349，验证api依赖项包含标准验证API：</p>
<figure class="highlight vbscript-html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.validation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>validation-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="3-2-Validation-API-Reference-Implementation"><a href="#3-2-Validation-API-Reference-Implementation" class="headerlink" title="3.2. Validation API Reference Implementation"></a><strong>3.2. Validation API Reference Implementation</strong></h3><p>Hibernate Validator是验证API的参考实现。为了使用它，我们必须添加以下依赖关系。</p>
<figure class="highlight vbscript-html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.1.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator-annotation-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.1.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<p>这里的一个快速说明是，hibernate验证器与Hibernate的持久性方面完全分离，并将其作为依赖项添加，我们不将这些持久性方面添加到项目中。</p>
<h3 id="3-3-Expression-Language-Dependencies"><a href="#3-3-Expression-Language-Dependencies" class="headerlink" title="3.3. Expression Language Dependencies"></a><strong>3.3. Expression Language Dependencies</strong></h3><p>JSR 349提供变量插值，允许表达式在违例消息中。为了解析这些表达式，我们必须在表达式语言API和该API的实现上添加依赖关系。 GlassFish提供了参考实现。</p>
<figure class="highlight vbscript-html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.el<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.el-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"> </div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.glassfish.web<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.el<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<p>如果未添加这些JAR，则会在运行时收到错误消息，如下所示：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">HV000183: Unable to <span class="keyword">load</span> ‘javax.el.ExpressionFactory’. <span class="keyword">Check</span> that you have the EL dependencies <span class="keyword">on</span> the classpath, <span class="keyword">or</span> <span class="keyword">use</span> ParameterMessageInterpolator instead</div></pre></td></tr></table></figure>
<h3 id="4-Using-Validation-Annotations"><a href="#4-Using-Validation-Annotations" class="headerlink" title="4. Using Validation Annotations"></a><strong>4. Using Validation Annotations</strong></h3><p>我们将使用User bean作为这里的主要示例，并致力于为其添加一些简单的验证：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> javax.validation.constraints.AssertTrue;</div><div class="line"><span class="keyword">import</span> javax.validation.constraints.Max;</div><div class="line"><span class="keyword">import</span> javax.validation.constraints.Min;</div><div class="line"><span class="keyword">import</span> javax.validation.constraints.NotNull;</div><div class="line"><span class="keyword">import</span> javax.validation.constraints.Size;</div><div class="line"> </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="meta">@NotNull</span>(message = <span class="string">"Name cannot be null"</span>)</div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line"> </div><div class="line">    <span class="meta">@AssertTrue</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> working;</div><div class="line"> </div><div class="line">    <span class="meta">@Size</span>(min = <span class="number">10</span>, max = <span class="number">200</span>, message = <span class="string">"About Me must be between 10 and 200 characters"</span>)</div><div class="line">    <span class="keyword">private</span> String aboutMe;</div><div class="line"> </div><div class="line">    <span class="meta">@Min</span>(value = <span class="number">18</span>, message = <span class="string">"Age should not be less than 18"</span>)</div><div class="line">    <span class="meta">@Max</span>(value = <span class="number">150</span>, message = <span class="string">"Age should not be greater than 150"</span>)</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</div><div class="line"> </div><div class="line">    <span class="comment">// standard setters and getters </span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>示例中使用的所有注释都是标准JSR注释：</p>
<ul>
<li>@NotNull – Validates that the annotated property value is not null 验证注释的属性值不为null</li>
<li>@AssertTrue – Validates that the annotated property value is true 验证注释属性值为true</li>
<li>@Size – Validates that the annotated property value has a size between the attributes min and max; can be applied to String, Collection, Map, and array properties 验证注释属性值的大小在属性min和max之间;可以应用于String，Collection，Map和数组属性</li>
<li>@Min – Validates that the annotated property has a value no smaller than the value attribute 验证注释属性的值不小于value属性</li>
<li>@Max – Validates that the annotated property has a value no larger than the value attribute 验证注释属性的值不大于value属性</li>
</ul>
<p>些注释接受附加属性，但是message属性对它们都是共同的。这是当相应属性的值验证失败时通常会显示的消息。</p>
<h1 id="5-Programmatic-Validation"><a href="#5-Programmatic-Validation" class="headerlink" title="5. Programmatic Validation"></a><strong>5. Programmatic Validation</strong></h1><p>一些框架（如Spring）有简单的方法可以通过使用注释触发验证过程。这主要是因为我们不必与编程验证API进行交互。</p>
<p>我们现在去手动路线，实际上是以编程方式设置的：</p>
<figure class="highlight sml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="type">ValidatorFactory</span> factory = <span class="type">Validation</span>.buildDefaultValidatorFactory<span class="literal">()</span>;</div><div class="line"><span class="type">Validator</span> validator = factory.getValidator<span class="literal">()</span>;</div></pre></td></tr></table></figure>
<p>为了验证一个bean，我们必须先使用一个ValidatorFactory来构造一个Validator对象。</p>
<h3 id="5-1-Defining-the-Bean"><a href="#5-1-Defining-the-Bean" class="headerlink" title="5.1. Defining the Bean"></a><strong>5.1. Defining the Bean</strong></h3><p>我们不会设置这个无效用户 - 使用空值名称：</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">User <span class="keyword">user</span> = new User();</div><div class="line"><span class="keyword">user</span>.<span class="built_in">set</span>Working(true);</div><div class="line"><span class="keyword">user</span>.<span class="built_in">set</span>AboutMe(<span class="string">"Its all about me!"</span>);</div><div class="line"><span class="keyword">user</span>.<span class="built_in">set</span>Age(<span class="number">50</span>);</div></pre></td></tr></table></figure>
<h3 id="5-2-Validate-the-Bean"><a href="#5-2-Validate-the-Bean" class="headerlink" title="5.2. Validate the Bean"></a><strong>5.2. Validate the Bean</strong></h3><p>现在我们有一个验证器，我们可以通过将它传递给validate方法来验证我们的bean。任何违反User对象中定义的约束的行为都将返回为Set。</p>
<blockquote>
<p>Set<constraintviolation<user>&gt; violations = validator.validate(user);</constraintviolation<user></p>
</blockquote>
<p>通过迭代违规，我们可以通过使用getMessage方法获取所有违规消息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (ConstraintViolation&lt;User&gt; violation : violations) &#123;</div><div class="line">    log.error(violation.getMessage()); </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在我们的示例（ifNameIsNull_nameValidationFails）中，该集合将包含一个单一的ConstraintViolation，其消息是“Name not not null”。</p>
<h1 id="6-Conclusion"><a href="#6-Conclusion" class="headerlink" title="6. Conclusion"></a><strong>6. Conclusion</strong></h1><p>本教程的重点是简单的通过标准的Java Validation API，并使用javax.validation注解和API说明了bean验证的基础知识</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">java</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/06/23/Java Bean Validation Basics/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-介绍Spring Remoting与HTTP Invokers" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/23/介绍Spring Remoting与HTTP Invokers/">介绍Spring Remoting与HTTP Invokers</a>
    </h1>
  

        
        <a href="/2017/06/23/介绍Spring Remoting与HTTP Invokers/" class="archive-article-date">
  	<time datetime="2017-06-23T01:31:46.226Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-06-23</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-Overview"><a href="#1-Overview" class="headerlink" title="1. Overview"></a><strong>1. Overview</strong></h2><p>在某些情况下，我们需要将系统分解成几个进程，每个进程都承担我们应用的不同方面的责任。在这些情况下，其中一个进程需要同步从另一个进程获取数据。</p>
<p>Spring Framework提供了一系列全面的称为Spring Remoting的工具，它允许我们调用远程服务，至少在某种程度上可以在本地使用。</p>
<p>在本文中，我们将基于Spring的HTTP调用器设置一个应用程序，该应用程序利用本机Java序列化和HTTP来在客户端和服务器应用程序之间提供远程方法调用。</p>
<h2 id="2-Service-Definition-服务定义"><a href="#2-Service-Definition-服务定义" class="headerlink" title="2. Service Definition 服务定义"></a><strong>2. Service Definition</strong> 服务定义</h2><p>假设我们要实施一个允许用户在驾驶室内预订乘坐系统。<br>我们还假设我们选择构建两个不同(distinct)的应用程序来实现这一目标</p>
<ul>
<li>一个预订引擎应用程序，以检查是否可以提供驾驶室请求，以及</li>
<li>一个前端Web应用程序，允许客户预订他们的乘车，确保驾驶室的可以有车被预定</li>
</ul>
<h3 id="2-1-Service-Interface-服务界面"><a href="#2-1-Service-Interface-服务界面" class="headerlink" title="2.1. Service Interface 服务界面"></a><strong>2.1. Service Interface 服务界面</strong></h3><p>当我们使用HTTP invokerr进行Spring Remoting时，我们必须通过一个接口定义我们的远程可访问服务，让Spring在客户端和服务器端创建代理，从而封装远程调用的技术。所以让我们开始一个服务的界面，让我们预订出租车：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CabBookingService</span> </span>&#123;</div><div class="line">    <span class="function">Booking <span class="title">bookRide</span><span class="params">(String pickUpLocation)</span> <span class="keyword">throws</span> BookingException</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果服务无法预订出租车，则会抛出一个BookingException异常。在这种情况下，不需要将类标记为Serializable，因为Exception已经实现了它：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookingException</span> <span class="keyword">extends</span> <span class="title">Exception</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BookingException</span><span class="params">(String message)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(message);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2-2-Packaging-the-Service-包装服务"><a href="#2-2-Packaging-the-Service-包装服务" class="headerlink" title="2.2. Packaging the Service 包装服务"></a><strong>2.2. Packaging the Service 包装服务</strong></h3><p>服务界面以及用作参数的所有自定义类，返回类型和异常必须在客户端和服务器的类路径中都可用。</p>
<p>执行此操作的最有效方法之一就是将它们全部包含在.jar文件中，该文件可以在服务器和客户端的pom.xml中作为依赖关系。</p>
<p>所以我们把所有的代码放在专门的Maven模块中，叫做“api”;我们将使用以下Maven坐标：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baeldung<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="3-Server-Application-服务程序"><a href="#3-Server-Application-服务程序" class="headerlink" title="3. Server Application  服务程序"></a><strong>3. Server Application  服务程序</strong></h2><p>我们来构建预订引擎应用程序，以使用Spring Boot公开服务</p>
<h3 id="3-1-Maven-Dependencies"><a href="#3-1-Maven-Dependencies" class="headerlink" title="3.1. Maven Dependencies"></a><strong>3.1. Maven Dependencies</strong></h3><p>首先，您需要确保您的项目正在使用Spring Boot：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></div></pre></td></tr></table></figure>
<p>你可以在这里找到最后一个Spring Boot版本。然后我们需要Web启动器模块：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<p>我们需要我们在上一步中组装的服务定义模块：</p>
<h3 id="3-2-Service-Implementation-服务实现"><a href="#3-2-Service-Implementation-服务实现" class="headerlink" title="3.2. Service Implementation 服务实现"></a><strong>3.2. Service Implementation</strong> 服务实现</h3><p>我们首先定义一个实现服务接口的类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CabBookingServiceImpl</span> <span class="keyword">implements</span> <span class="title">CabBookingService</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> Booking <span class="title">bookPickUp</span><span class="params">(String pickUpLocation)</span> <span class="keyword">throws</span> BookingException </span>&#123;</div><div class="line">        <span class="keyword">if</span> (random() &lt; <span class="number">0.3</span>) <span class="keyword">throw</span> <span class="keyword">new</span> BookingException(<span class="string">"Cab unavailable"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Booking(randomUUID().toString());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>假设这是一个可能的实现。使用具有随机值的测试，我们将能够重现两个成功的场景 - 当找到可用的驾驶室并返回一个预留代码，并且发生故障时 - 抛出一个BookingException来表示没有任何可用的驾驶室。</p>
<h3 id="3-3-Exposing-the-Service-公开服务"><a href="#3-3-Exposing-the-Service-公开服务" class="headerlink" title="3.3. Exposing the Service 公开服务"></a><strong>3.3. Exposing the Service</strong> 公开服务</h3><p>然后，我们需要在上下文中定义一个类型为HttpInvokerServiceExporter的bean的应用程序。它将在Web应用程序中暴露一个HTTP入口点，这将由客户端稍后调用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="meta">@ComponentScan</span></div><div class="line"><span class="meta">@EnableAutoConfiguration</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="meta">@Bean</span>(name = <span class="string">"/booking"</span>) <span class="function">HttpInvokerServiceExporter <span class="title">accountService</span><span class="params">()</span> </span>&#123;</div><div class="line">        HttpInvokerServiceExporter exporter = <span class="keyword">new</span> HttpInvokerServiceExporter();</div><div class="line">        exporter.setService( <span class="keyword">new</span> CabBookingServiceImpl() );</div><div class="line">        exporter.setServiceInterface( CabBookingService.class );</div><div class="line">        <span class="keyword">return</span> exporter;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        SpringApplication.run(Server.class, args);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>值得注意的是，Spring的HTTP调用者使用HttpInvokerServiceExporter bean的名称作为HTTP端点URL的相对路径</p>
<p>我们现在可以在设置客户端应用程序时启动服务器应用程序并保持运行。</p>
<h2 id="4-Client-Application"><a href="#4-Client-Application" class="headerlink" title="4. Client Application"></a><strong>4. Client Application</strong></h2><p>现在我们来写客户端应用程序。</p>
<h2 id="4-1-Maven-Dependencies"><a href="#4-1-Maven-Dependencies" class="headerlink" title="4.1. Maven Dependencies"></a><strong>4.1. Maven Dependencies</strong></h2><p>我们将使用相同的服务定义和我们在服务器端使用的相同的Spring引导版本。我们仍然需要Web起始依赖关系，但由于我们不需要自动启动嵌入式容器，因此我们可以从依赖关系中排除Tomcat启动器：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="4-2-Client-Implementation"><a href="#4-2-Client-Implementation" class="headerlink" title="4.2. Client Implementation"></a><strong>4.2. Client Implementation</strong></h3><p>让我们来是想客户端：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="function"><span class="keyword">public</span> HttpInvokerProxyFactoryBean <span class="title">invoker</span><span class="params">()</span> </span>&#123;</div><div class="line">        HttpInvokerProxyFactoryBean invoker = <span class="keyword">new</span> HttpInvokerProxyFactoryBean();</div><div class="line">        invoker.setServiceUrl(<span class="string">"http://localhost:8080/booking"</span>);</div><div class="line">        invoker.setServiceInterface(CabBookingService.class);</div><div class="line">        <span class="keyword">return</span> invoker;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> BookingException </span>&#123;</div><div class="line">        CabBookingService service = SpringApplication</div><div class="line">          .run(Client.class, args)</div><div class="line">          .getBean(CabBookingService.class);</div><div class="line">        out.println(service.bookRide(<span class="string">"13 Seagate Blvd, Key Largo, FL 33037"</span>));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>@Bean注释的invoker（）方法创建一个HttpInvokerProxyFactoryBean的实例。我们需要通过setServiceUrl（）方法提供远程服务器响应的URL。</p>
<p>与我们为服务器做的一样，我们还应该通过setServiceInterface（）方法提供我们想要远程调用的服务的接口。</p>
<p>HttpInvokerProxyFactoryBean实现了Spring的FactoryBean。一个FactoryBean被定义为一个bean，但是Spring IoC容器将注入它创建的对象，而不是工厂本身。您可以在我们的工厂bean文章中找到关于FactoryBean的更多详细信息。</p>
<p>main（）方法引导独立应用程序，并从上下文获取CabBookingService的实例。在引擎盖下，此对象只是由HttpInvokerProxyFactoryBean创建的代理，它负责执行远程调用所涉及的所有技术性。感谢它让我们可以轻松地使用代理，就像我们在本地可用的服务实现一样。</p>
<p>让我们多次运行应用程序来执行多个远程调用，以验证客户端在出租车是否可用时的运行方式。</p>
<h2 id="5-Caveat-Emptor-注意事项"><a href="#5-Caveat-Emptor-注意事项" class="headerlink" title="5. Caveat Emptor 注意事项"></a><strong>5. Caveat Emptor</strong> 注意事项</h2><p>当我们使用允许远程调用的技术时，我们必须应该知道他的一些陷阱。</p>
<h3 id="5-1谨防网络相关的异常"><a href="#5-1谨防网络相关的异常" class="headerlink" title="5.1谨防网络相关的异常"></a><strong>5.1谨防网络相关的异常</strong></h3><p>当我们使用不可靠的资源作为网络时，我们应该总是期待意想不到的。 假设客户端正在调用服务器，而无法访问服务器 - 由于网络问题或服务器关闭 - 那么Spring Remoting会引发一个RuntimeException异常的RemoteAccessException。</p>
<p>编译器不会迫使我们将调用包含在try-catch块中，但是我们应该始终考虑这样做，以正确地管理网络问题。</p>
<h3 id="5-2-Objects-are-Transferred-by-Value-not-by-Reference"><a href="#5-2-Objects-are-Transferred-by-Value-not-by-Reference" class="headerlink" title="5.2. Objects are Transferred by Value, not by Reference"></a><strong>5.2. Objects are Transferred by Value, not by Reference</strong></h3><p>Spring Remoting HTTP传递方法参数并且返回值以便在网络上传输它们。这意味着服务器将作用于提供的参数的副本，并且客户端对由服务器创建的结果的副本执行操作。</p>
<p>所以我们不能指望，例如，在结果对象上调用一个方法会改变服务器端同一对象的状态，因为客户端和服务器之间没有任何共享对象。</p>
<h3 id="5-3。注意细粒度接口"><a href="#5-3。注意细粒度接口" class="headerlink" title="5.3。注意细粒度接口"></a><strong>5.3。注意细粒度接口</strong></h3><p>通过网络边界调用方法比在同一进程中的对象上调用方法要慢得多。</p>
<p>因此，通过较粗糙的界面来定义应该远程调用服务的服务通常是一个很好的做法，即使以更麻烦的界面为代价，也能够完成需要较少交互的业务交易。</p>
<h2 id="6-Conclusion"><a href="#6-Conclusion" class="headerlink" title="6. Conclusion"></a><strong>6. Conclusion</strong></h2><p>有了这个例子，我们看到Spring Remoting如何方便地调用远程进程。</p>
<p>该解决方案比其他广泛的机制（如REST或Web服务）稍微开放，但是在所有组件都使用Spring开发的情况下，它可以代表可行且更快速的替代方案。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">spring</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/06/23/介绍Spring Remoting与HTTP Invokers/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-Introduction to RabbitMQ" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/23/Introduction to RabbitMQ/">Introduction to RabbitMQ</a>
    </h1>
  

        
        <a href="/2017/06/23/Introduction to RabbitMQ/" class="archive-article-date">
  	<time datetime="2017-06-23T01:31:38.721Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-06-23</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Introduction-to-RabbitMQ"><a href="#Introduction-to-RabbitMQ" class="headerlink" title="Introduction to RabbitMQ"></a><strong>Introduction to RabbitMQ</strong></h1><h2 id="1-Overview"><a href="#1-Overview" class="headerlink" title="1. Overview"></a><strong>1. Overview</strong></h2><p>软件组件的去耦是软件设计中最重要的部分之一。实现这一点的一种方法是使用消息系统，其提供组件（服务）之间的异步通信方式。在本文中，我们将介绍一个这样的系统：RabbitMQ</p>
<p>RabbitMQ是实现高级消息队列协议（AMQP）的消息代理。它为主要的编程语言提供客户端库。</p>
<p>除了用于去耦软件组件之外，RabbitMQ可用于：</p>
<ul>
<li>执行后台操作</li>
<li>执行异步操作</li>
</ul>
<h2 id="2-Messaging-Model"><a href="#2-Messaging-Model" class="headerlink" title="2. Messaging Model"></a><strong>2. Messaging Model</strong></h2><p>首先，让我们快速，高级地了解消息传递的工作原理。</p>
<p>简单地说，有两种应用程序与消息系统交互：生产者和消费者。生产者是向broker发送（发布）消息的消费者，以及从broker接收消息的消费者。通常，该程序（软件组件）在不同的机器上运行，RabbitMQ作为它们之间的通信中间件</p>
<p>在本文中，我们将讨论一个使用RabbitMQ进行通信的两个服务的简单示例。其中一个服务将向RabbitMQ发布消息，另一个将消耗。</p>
<h2 id="3-Setup"><a href="#3-Setup" class="headerlink" title="3. Setup"></a><strong>3. Setup</strong></h2><p>为了开始，我们在这里使用官方设置指南运行RabbitMQ。 我们自然会使用Java客户端与RabbitMQ服务器交互;该客户端的Maven依赖关系是：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.rabbitmq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>amqp-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<p>使用官方指南运行RabbitMQ代理后，我们需要使用java客户端连接到它：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</div><div class="line">factory.setHost(<span class="string">"localhost"</span>);</div><div class="line">Connection connection = factory.newConnection();</div><div class="line">Channel channel = connection.createChannel();</div></pre></td></tr></table></figure>
<p>我们使用ConnectionFactory来设置与服务器的连接，它也负责协议（AMQP）和认证。这里我们连接到localhost上的服务器，我们可以使用setHost函数修改主机名。</p>
<p>如果RabbitMQ Server不使用默认端口，我们可以使用setPort设置端口; RabbitMQ的默认端口为15672：</p>
<blockquote>
<p>factory.setPort(15678);</p>
</blockquote>
<p>我们可以设置用户名和密码：</p>
<blockquote>
<p>factory.setUsername(“user1”);<br>factory.setPassword(“MyPassword”);</p>
</blockquote>
<p>此外，我们将使用此连接来发布和使用消息。</p>
<h2 id="4-Producer"><a href="#4-Producer" class="headerlink" title="4. Producer"></a><strong>4. Producer</strong></h2><p>考虑一个简单的场景，Web应用程序允许用户向网站添加新产品。任何新增产品，我们都需要向客户发送电子邮件。</p>
<p>首先，我们定义一个队列：</p>
<blockquote>
<p>channel.queueDeclare(“products_queue”, false, false, false, null);</p>
</blockquote>
<p>每当用户添加新产品时，我们都会将消息发布到队列中：</p>
<blockquote>
<p>String message = “product details”;<br>channel.basicPublish(“”, “products_queue”, null, message.getBytes());</p>
</blockquote>
<p>最后，我们关闭渠道和连接：</p>
<blockquote>
<p>channel.close();<br>connection.close();</p>
</blockquote>
<p>此消息将被另一个负责向客户发送电子邮件的服务使用。</p>
<h2 id="5-Consumer"><a href="#5-Consumer" class="headerlink" title="5. Consumer"></a><strong>5. Consumer</strong></h2><p>看看我们能实现消费者的一面,我们要声明同一个队列：</p>
<blockquote>
<p>channel.queueDeclare(“products_queue”, false, false, false, null);</p>
</blockquote>
<p>以下是我们如何定义将异步处理来自队列的消息的消费者：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">Consumer consumer = <span class="keyword">new</span> DefaultConsumer(channel) &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(</span></span></div><div class="line">        String consumerTag,</div><div class="line">        Envelope envelope, </div><div class="line">        AMQP.BasicProperties properties, </div><div class="line">        <span class="keyword">byte</span>[] body) <span class="keyword">throws</span> IOException &#123;</div><div class="line">  </div><div class="line">            String message = <span class="keyword">new</span> String(body, <span class="string">"UTF-8"</span>);</div><div class="line">            <span class="comment">// process the message</span></div><div class="line">     &#125;</div><div class="line">&#125;;</div><div class="line">channel.basicConsume(<span class="string">"products_queue"</span>, <span class="keyword">true</span>, consumer);</div></pre></td></tr></table></figure>
<h2 id="6-Conclusion"><a href="#6-Conclusion" class="headerlink" title="6. Conclusion"></a><strong>6. Conclusion</strong></h2><p>这篇简单的文章介绍了RabbitMQ的基本概念，并讨论了一个使用它的简单示例。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">programming</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/06/23/Introduction to RabbitMQ/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-Spring Remoting with AMQP" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/23/Spring Remoting with AMQP/">Spring Remoting with AMQP</a>
    </h1>
  

        
        <a href="/2017/06/23/Spring Remoting with AMQP/" class="archive-article-date">
  	<time datetime="2017-06-23T01:31:31.068Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-06-23</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Spring-Remoting-with-AMQP"><a href="#Spring-Remoting-with-AMQP" class="headerlink" title="Spring Remoting with AMQP"></a><strong>Spring Remoting with AMQP</strong></h1><h2 id="1-Overview"><a href="#1-Overview" class="headerlink" title="1. Overview"></a><strong>1. Overview</strong></h2><p>我们在本系列的前一期中看到了如何利用Spring Remoting和相关技术，在服务器和客户端之间的HTTP通道之上启用同步远程过程调用。</p>
<p>在本文中，我们将在AMQP之上探索Spring Remoting，这样可以在利用本质上是异步的介质的同时执行同步RPC。</p>
<h2 id="2-Installing-RabbitMQ"><a href="#2-Installing-RabbitMQ" class="headerlink" title="2. Installing RabbitMQ"></a><strong>2. Installing RabbitMQ</strong></h2><p>有各种与AMQP兼容的消息系统，我们可以使用，我们选择RabbitMQ，因为它是一个成熟的平台，它在Spring中得到完全支持 - 两个产品都由同一家公司（Pivotal）进行管理。</p>
<p>如果您不熟悉AMQP或RabbitMQ，您可以阅读我们的快速介绍。</p>
<p>所以，第一步是安装和启动RabbitMQ。有多种方法来安装它 - 只需选择您喜欢的方法，按照官方指南中提到的步骤。</p>
<h2 id="3-Maven-Dependencies"><a href="#3-Maven-Dependencies" class="headerlink" title="3. Maven Dependencies"></a><strong>3. Maven Dependencies</strong></h2><p>我们将设置服务器和客户端Spring Boot应用程序来显示AMQP Remoting的工作原理。通常情况下，Spring Boot，我们只需要选择和导入正确的启动器依赖关系，如下所述：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<p>我们明确地排除了spring-boot-starter-tomcat，因为我们不需要任何嵌入式HTTP服务器 - 如果我们允许Maven导入类路径中的所有传递依赖项，将自动启动。</p>
<h2 id="4-Server-Application"><a href="#4-Server-Application" class="headerlink" title="4. Server Application"></a><strong>4. Server Application</strong></h2><h3 id="4-1-Expose-the-Service"><a href="#4-1-Expose-the-Service" class="headerlink" title="4.1. Expose the Service"></a><strong>4.1. Expose the Service</strong></h3><p>正如我们在前面的文章中所示，我们将公开一个模拟可能的远程服务的CabBookingService。</p>
<p>我们首先声明一个实现我们想要远程调用的服务接口的bean。这是在服务器端实际执行服务调用的bean：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Bean</span></div><div class="line"><span class="function">CabBookingService <span class="title">bookingService</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> CabBookingServiceImpl();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后我们定义服务器将从中检索调用的队列。在这种情况下，为它指定一个名称就足够了，在构造函数中提供它：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Bean</span></div><div class="line"><span class="function">Queue <span class="title">queue</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">"remotingQueue"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>正如我们从前面的文章中已经知道的那样，Spring Remoting的主要概念之一就是服务导出器，这个组件实际上是从一些来源收集调用请求的 - 在这种情况下是一个RabbitMQ队列 - 并且在服务器上调用所需的方法实现。</p>
<p>在这种情况下，我们定义一个AmqpInvokerServiceExporter，可以看到─需要引用AmqpTemplate。 AmqpTemplate类由Spring Framework提供，简化了与AMQP兼容的消息传递系统的处理方式，与JdbcTemplate更易于处理数据库的方式相同。</p>
<p>我们不会明确定义这样的AmqpTemplate bean，因为它将由Spring Boot自动配置模块自动提供：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Bean</span> <span class="function">AmqpInvokerServiceExporter <span class="title">exporter</span><span class="params">(</span></span></div><div class="line">  CabBookingService implementation, AmqpTemplate template) &#123;</div><div class="line">  </div><div class="line">    AmqpInvokerServiceExporter exporter = <span class="keyword">new</span> AmqpInvokerServiceExporter();</div><div class="line">    exporter.setServiceInterface(CabBookingService.class);</div><div class="line">    exporter.setService(implementation);</div><div class="line">    exporter.setAmqpTemplate(template);</div><div class="line">    <span class="keyword">return</span> exporter;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最后，我们需要定义一个容器，它有责任使用队列中的消息，并将它们转发到某些指定的监听器。</p>
<p>然后，我们将将此容器连接到我们在上一步中创建的服务导出器，以允许它接收排队的消息。这里ConnectionFactory由Spring Boot自动提供，与AmqpTemplate相同：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Bean</span></div><div class="line"><span class="function">SimpleMessageListenerContainer <span class="title">listener</span><span class="params">(</span></span></div><div class="line">  ConnectionFactory facotry, </div><div class="line">  AmqpInvokerServiceExporter exporter, </div><div class="line">  Queue queue) &#123;</div><div class="line">  </div><div class="line">    SimpleMessageListenerContainer container</div><div class="line">     = <span class="keyword">new</span> SimpleMessageListenerContainer(facotry);</div><div class="line">    container.setMessageListener(exporter);</div><div class="line">    container.setQueueNames(queue.getName());</div><div class="line">    <span class="keyword">return</span> container;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="4-2-Configuration"><a href="#4-2-Configuration" class="headerlink" title="4.2. Configuration"></a><strong>4.2. Configuration</strong></h2><p>我们记得设置application.properties文件以允许Spring Boot配置基本对象。显然，参数的值也取决于RabbitMQ的安装方式。</p>
<p>例如，当RabbitMQ运行该示例运行的相同机器时，以下可能是一个合理的配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">spring.rabbitmq.dynamic=<span class="keyword">true</span></div><div class="line">spring.rabbitmq.port=<span class="number">5672</span></div><div class="line">spring.rabbitmq.username=guest</div><div class="line">spring.rabbitmq.password=guest</div><div class="line">spring.rabbitmq.host=localhost</div></pre></td></tr></table></figure>
<h2 id="5-Client-Application"><a href="#5-Client-Application" class="headerlink" title="5. Client Application"></a><strong>5. Client Application</strong></h2><h3 id="5-1-Invoke-the-Remote-Service"><a href="#5-1-Invoke-the-Remote-Service" class="headerlink" title="5.1. Invoke the Remote Service"></a><strong>5.1. Invoke the Remote Service</strong></h3><p>我们现在来处理客户。同样，我们需要定义调用消息将被写入的队列。我们需要仔细检查客户端和服务器是否使用相同的名称。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Bean</span></div><div class="line"><span class="function">Queue <span class="title">queue</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">"remotingQueue"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在客户端，我们需要比服务器端稍微复杂的设置。实际上，我们需要定义一个具有相关绑定的Exchange：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Bean</span></div><div class="line"><span class="function">Exchange <span class="title">directExchange</span><span class="params">(Queue someQueue)</span> </span>&#123;</div><div class="line">    DirectExchange exchange = <span class="keyword">new</span> DirectExchange(<span class="string">"remoting.exchange"</span>);</div><div class="line">    BindingBuilder</div><div class="line">      .bind(someQueue)</div><div class="line">      .to(exchange)</div><div class="line">      .with(<span class="string">"remoting.binding"</span>);</div><div class="line">    <span class="keyword">return</span> exchange;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>关于RabbitMQ作为交换和绑定的主要概念的一个很好的介绍可以在这里。</p>
<p>由于Spring Boot不自动配置AmqpTemplate，因此我们必须自己设置一个，指定一个路由密钥。在这样做时，我们需要仔细检查路由密钥和交换机是否与上一步中用于定义Exchange的交换机匹配</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Bean</span> <span class="function">RabbitTemplate <span class="title">amqpTemplate</span><span class="params">(ConnectionFactory factory)</span> </span>&#123;</div><div class="line">    RabbitTemplate template = <span class="keyword">new</span> RabbitTemplate(factory);</div><div class="line">    template.setRoutingKey(<span class="string">"remoting.binding"</span>);</div><div class="line">    template.setExchange(<span class="string">"remoting.exchange"</span>);</div><div class="line">    <span class="keyword">return</span> template;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后，正如我们与其他Spring Remoting实现一样，我们定义了一个FactoryBean，它将生成远程暴露的服务的本地代理。没有什么太奇怪，我们只需要提供远程服务的接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Bean</span> <span class="function">AmqpProxyFactoryBean <span class="title">amqpFactoryBean</span><span class="params">(AmqpTemplate amqpTemplate)</span> </span>&#123;</div><div class="line">    AmqpProxyFactoryBean factoryBean = <span class="keyword">new</span> AmqpProxyFactoryBean();</div><div class="line">    factoryBean.setServiceInterface(CabBookingService.class);</div><div class="line">    factoryBean.setAmqpTemplate(amqpTemplate);</div><div class="line">    <span class="keyword">return</span> factoryBean;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们现在可以使用远程服务，就像它被声明为本地bean一样：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">CabBookingService service = context.getBean(CabBookingService.class);</div><div class="line">out.println(service.bookRide(<span class="string">"13 Seagate Blvd, Key Largo, FL 33037"</span>));</div></pre></td></tr></table></figure>
<h3 id="5-2-Setup"><a href="#5-2-Setup" class="headerlink" title="5.2. Setup"></a><strong>5.2. Setup</strong></h3><p>同样对于客户端应用程序，我们必须正确选择application.properties文件中的值。在一个常见的设置中，那些将与服务器端使用的设置完全匹配。</p>
<h3 id="5-3-Run-the-Example"><a href="#5-3-Run-the-Example" class="headerlink" title="5.3. Run the Example"></a><strong>5.3. Run the Example</strong></h3><p>这应该足以证明通过RabbitMQ的远程调用。然后我们启动RabbitMQ，服务器应用程序和调用远程服务的客户端应用程序。</p>
<p>幕后发生的是AmqpProxyFactoryBean将构建一个实现CabBookingService的代理。</p>
<p>当在该代理上调用一个方法时，它会对RabbitMQ上的消息进行排队，在其中指定调用的所有参数和用于发回结果的队列名称。</p>
<p>消息从调用实际实现的AmqpInvokerServiceExporter中消耗。然后，将结果收集到消息中，并将其放在队列中，该名称在传入消息中指定。</p>
<p>AmqpProxyFactoryBean接收到结果，最后返回最初在服务器端生成的值。</p>
<h2 id="6-Conclusion"><a href="#6-Conclusion" class="headerlink" title="6. Conclusion"></a><strong>6. Conclusion</strong></h2><p>在本文中，我们看到了如何使用Spring Remoting在消息传递系统之上提供RPC。</p>
<p>这可能不是我们可能喜欢利用RabbitMQ的异步性的主要场景的方式，但是在某些选定和有限的情况下，同步调用可以更容易理解，并且更快更简单地开发。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">spring</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/06/23/Spring Remoting with AMQP/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-Spring YAML Configuration" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/22/Spring YAML Configuration/">Spring YAML Configuration</a>
    </h1>
  

        
        <a href="/2017/06/22/Spring YAML Configuration/" class="archive-article-date">
  	<time datetime="2017-06-22T13:16:37.844Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-06-22</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-Overview"><a href="#1-Overview" class="headerlink" title="1. Overview"></a><strong>1. Overview</strong></h2><p>配置Spring应用程序的一种方法是使用YAML配置文件。 在这篇快速的文章中，我们将使用YAML为简单的Spring引导应用程序配置不同的配置文件</p>
<h2 id="2-Spring-YAML-File"><a href="#2-Spring-YAML-File" class="headerlink" title="2. Spring YAML File"></a><strong>2. Spring YAML File</strong></h2><p>Spring配置文件可帮助Spring应用程序为不同环境定义不同的属性。 以下是一个包含两个配置文件的简单YAML文件。</p>
<p>分隔两个配置文件的三个虚线表示新文档的开始，因此所有配置文件都可以在同一个YAML文件中进行描述。</p>
<p>application.yml文件的相对路径是/myApplication/src/main/resources/application.yml。</p>
<p>Spring应用程序将第一个配置文件作为默认配置文件，除非在Spring应用程序中另外声明。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">spring:</div><div class="line">    profiles: test</div><div class="line">name: test-YAML</div><div class="line">environment: test</div><div class="line">servers: </div><div class="line">    - www.abc.test.com</div><div class="line">    - www.xyz.test.com</div><div class="line"> </div><div class="line">---</div><div class="line">spring:</div><div class="line">    profiles: prod</div><div class="line">name: prod-YAML</div><div class="line">environment: production</div><div class="line">servers: </div><div class="line">    - www.abc.com</div><div class="line">    - www.xyz.com</div></pre></td></tr></table></figure>
<h2 id="3-Binding-YAML-to-a-Config-Class"><a href="#3-Binding-YAML-to-a-Config-Class" class="headerlink" title="3. Binding YAML to a Config Class"></a><strong>3. Binding YAML to a Config Class</strong></h2><p>要从属性文件加载一组相关属性，我们将创建一个bean类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="meta">@EnableConfigurationProperties</span></div><div class="line"><span class="meta">@ConfigurationProperties</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">YAMLConfig</span> </span>&#123;</div><div class="line">  </div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line">    <span class="keyword">private</span> String environment;</div><div class="line">    <span class="keyword">private</span> List&lt;String&gt; servers = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line"> </div><div class="line">    <span class="comment">// standard getters and setters</span></div><div class="line"> </div><div class="line">&#125;</div><div class="line">enter code here</div></pre></td></tr></table></figure>
<p>这里使用的注释是：</p>
<ul>
<li>@Configuration将该类定义为bean定义的源</li>
<li>@ConfigurationProperties将外部配置绑定并验证配置类</li>
<li>@EnableConfigurationProperties此注释用于在Spring应用程序中启用@ConfigurationProperties注释的bean</li>
</ul>
<h2 id="4-Accessing-the-YAML-Properties"><a href="#4-Accessing-the-YAML-Properties" class="headerlink" title="4. Accessing the YAML Properties"></a><strong>4. Accessing the YAML Properties</strong></h2><p>要访问YAML属性，我们创建一个YAMLConfig类的对象，并使用该对象访问属性。</p>
<p>在属性文件中，我们将spring.active.profiles环境变量设置为prod。如果我们没有定义spring.profiles.active，它将默认为YAML文件中定义的第一个配置文件属性。 属性文件的相对路径为/myApplication/src/main/resources/application.properties。</p>
<blockquote>
<p>spring.profiles.active=prod</p>
</blockquote>
<p>在这个例子中，我们使用CommandLineRunner显示属性。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@SpringBootApplication</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> YAMLConfig myConfig;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        SpringApplication app = <span class="keyword">new</span> SpringApplication(MyApplication.class);</div><div class="line">        app.run();</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        System.out.println(<span class="string">"using environment: "</span> + myConfig.getEnvironment());</div><div class="line">        System.out.println(<span class="string">"name: "</span> + myConfig.getName());</div><div class="line">        System.out.println(<span class="string">"servers: "</span> + myConfig.getServers());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>命令行上的输出：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">using environment: production</div><div class="line">name: prod-YAML</div><div class="line">servers: [www.abc.com, www.xyz.com]</div></pre></td></tr></table></figure>
<h2 id="5-YAML-Property-Overriding"><a href="#5-YAML-Property-Overriding" class="headerlink" title="5. YAML Property Overriding"></a><strong>5. YAML Property Overriding</strong></h2><p>在Spring Boot中，YAML文件可以被其他YAML属性文件覆盖，具体取决于它们的位置。 YAML属性可以由以下位置的属性文件覆盖，首先以最高优先顺序排列：</p>
<ul>
<li>Profiles’ properties placed outside the packaged jar 配置文件的属性放在打包的jar的外面</li>
<li>Profiles’ properties packaged inside the packaged jar  配置文件的属性放在打包的jar的里面</li>
<li>Application properties placed outside the packaged jar 应用程序属性放置在打包的jar的外面</li>
<li>Application properties packaged inside the packaged jar 应用程序属性放置在打包的jar的里面</li>
</ul>
<h2 id="6-Conclusion"><a href="#6-Conclusion" class="headerlink" title="6. Conclusion"></a><strong>6. Conclusion</strong></h2><p>在这篇快速的文章中，我们已经了解了如何使用YAML在Spring引导应用程序中配置属性。我们也看到了Spring Boot for YAML文件的属性覆盖规则。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">spring</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/06/22/Spring YAML Configuration/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-使用Spring Boot创建自定义自动配置" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/22/使用Spring Boot创建自定义自动配置/">使用Spring Boot创建自定义自动配置</a>
    </h1>
  

        
        <a href="/2017/06/22/使用Spring Boot创建自定义自动配置/" class="archive-article-date">
  	<time datetime="2017-06-22T13:16:31.940Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-06-22</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-Overview"><a href="#1-Overview" class="headerlink" title="1. Overview"></a><strong>1. Overview</strong></h2><p>简单的来说，Spring Boot autoconfiguration是基于在类路径中存在的依赖关系来自动配置一个Spring应用程序的一种方式。</p>
<p>这可以通过消除定义自动配置类中包含的某些bean的需要，使开发更快更容易。</p>
<p>在下面的部分中，我们将介绍如何创建自定义的Spring Boot自动配置。</p>
<h2 id="2-Maven-Dependencies"><a href="#2-Maven-Dependencies" class="headerlink" title="2. Maven Dependencies"></a><strong>2. Maven Dependencies</strong></h2><p>我们从我们需要的依赖开始：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.0.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="3-Creating-a-Custom-Auto-Configuration"><a href="#3-Creating-a-Custom-Auto-Configuration" class="headerlink" title="3. Creating a Custom Auto-Configuration"></a><strong>3. Creating a Custom Auto-Configuration</strong></h2><p>要创建自定义自动配置，我们需要创建一个注释为@Configuration并注册的类。.</p>
<p>我们为MySQL数据源创建一个自定义配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySQLAutoconfiguration</span> </span>&#123;</div><div class="line">    <span class="comment">//...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>下一个强制性步骤是通过在标准文件资源/ META-INF / spring.factory中的org.springframework.boot.autoconfigure.EnableAutoConfiguration项下添加类的名称来将类注册为自动配置候选项：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</div><div class="line">com.baeldung.autoconfiguration.MySQLAutoconfiguration</div></pre></td></tr></table></figure>
<p>如果我们希望我们的自动配置类优先于其他自动配置候选，我们可以添加<strong>@AutoConfigureOrder（Ordered.HIGHEST_PRECEDENCE）</strong>注释</p>
<p>请注意，只有在应用程序中未定义自动配置的bean时，自动配置才有效。如果你定义你的bean，那么默认的bean将被覆盖。</p>
<h3 id="3-1-Class-Conditions"><a href="#3-1-Class-Conditions" class="headerlink" title="3.1. Class Conditions"></a><strong>3.1. Class Conditions</strong></h3><p>类条件允许我们指定如果存在指定的类，使用@ConditionalOnClass注释，或者如果一个类不存在的时候使用@ConditionalOnMissingClass注释。</p>
<p>我们指定我们的MySQLConfiguration只有在DataSource类存在时才会加载，在这种情况下，我们可以假定应用程序将使用数据库：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="meta">@ConditionalOnClass</span>(DataSource.class)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySQLAutoconfiguration</span> </span>&#123;</div><div class="line">    <span class="comment">//...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3-2-Bean-Conditions"><a href="#3-2-Bean-Conditions" class="headerlink" title="3.2. Bean Conditions"></a><strong>3.2. Bean Conditions</strong></h3><p>如果我们仅在指定的bean存在的情况下才包含一个bean，那么我们可以使用@ConditionalOnBean和@ConditionalOnMissingBean注释。</p>
<p>为了说明这一点，我们将entityManagerFactory bean添加到我们的配置类中，并指定如果存在称为dataSource的bean并且一个名为entityManagerFactory的bean还没有被定义，则创建该bean：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Bean</span></div><div class="line"><span class="meta">@ConditionalOnBean</span>(name = <span class="string">"dataSource"</span>)</div><div class="line"><span class="meta">@ConditionalOnMissingBean</span></div><div class="line"><span class="function"><span class="keyword">public</span> LocalContainerEntityManagerFactoryBean <span class="title">entityManagerFactory</span><span class="params">()</span> </span>&#123;</div><div class="line">    LocalContainerEntityManagerFactoryBean em</div><div class="line">      = <span class="keyword">new</span> LocalContainerEntityManagerFactoryBean();</div><div class="line">    em.setDataSource(dataSource());</div><div class="line">    em.setPackagesToScan(<span class="string">"com.baeldung.autoconfiguration.example"</span>);</div><div class="line">    em.setJpaVendorAdapter(<span class="keyword">new</span> HibernateJpaVendorAdapter());</div><div class="line">    <span class="keyword">if</span> (additionalProperties() != <span class="keyword">null</span>) &#123;</div><div class="line">        em.setJpaProperties(additionalProperties());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> em;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们还要配置一个仅在没有定义类型为JpaTransactionManager的bean的情况下加载的transactionManager bean：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Bean</span></div><div class="line"><span class="meta">@ConditionalOnMissingBean</span>(type = <span class="string">"JpaTransactionManager"</span>)</div><div class="line"><span class="function">JpaTransactionManager <span class="title">transactionManager</span><span class="params">(EntityManagerFactory entityManagerFactory)</span> </span>&#123;</div><div class="line">    JpaTransactionManager transactionManager = <span class="keyword">new</span> JpaTransactionManager();</div><div class="line">    transactionManager.setEntityManagerFactory(entityManagerFactory);</div><div class="line">    <span class="keyword">return</span> transactionManager;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="3-3-Property-Conditions"><a href="#3-3-Property-Conditions" class="headerlink" title="3.3. Property Conditions"></a><strong>3.3. Property Conditions</strong></h2><p>@ConditionalOnProperty注释用于指定是否将根据Spring Environment属性的存在和值来加载配置。</p>
<p>首先，我们为配置添加一个属性源文件，该文件将决定从哪里读取属性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@PropertySource</span>(<span class="string">"classpath:mysql.properties"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySQLAutoconfiguration</span> </span>&#123;</div><div class="line">    <span class="comment">//...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们可以配置主DataSource bean，该bean将用于创建与数据库的连接，只有当存在名为usemysql的属性时才会加载它。</p>
<p>我们可以使用hasValue属性来指定必须匹配的usemysql属性的某些值。</p>
<p>如果将usemysql属性设置为local，则使用默认值定义dataSource bean，该值将连接到名为myDb的本地数据库</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Bean</span></div><div class="line"><span class="meta">@ConditionalOnProperty</span>(</div><div class="line">  name = <span class="string">"usemysql"</span>, </div><div class="line">  havingValue = <span class="string">"local"</span>)</div><div class="line"><span class="meta">@ConditionalOnMissingBean</span></div><div class="line"><span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</div><div class="line">    DriverManagerDataSource dataSource = <span class="keyword">new</span> DriverManagerDataSource();</div><div class="line">  </div><div class="line">    dataSource.setDriverClassName(<span class="string">"com.mysql.cj.jdbc.Driver"</span>);</div><div class="line">    dataSource.setUrl(<span class="string">"jdbc:mysql://localhost:3306/myDb?createDatabaseIfNotExist=true"</span>);</div><div class="line">    dataSource.setUsername(<span class="string">"mysqluser"</span>);</div><div class="line">    dataSource.setPassword(<span class="string">"mysqlpass"</span>);</div><div class="line"> </div><div class="line">    <span class="keyword">return</span> dataSource;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果将usemysql属性设置为自定义，则将使用dataSource bean的自定义属性值配置：数据库URL，用户和密码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Bean</span>(name = <span class="string">"dataSource"</span>)</div><div class="line"><span class="meta">@ConditionalOnProperty</span>(</div><div class="line">  name = <span class="string">"usemysql"</span>, </div><div class="line">  havingValue = <span class="string">"custom"</span>)</div><div class="line"><span class="meta">@ConditionalOnMissingBean</span></div><div class="line"><span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource2</span><span class="params">()</span> </span>&#123;</div><div class="line">    DriverManagerDataSource dataSource = <span class="keyword">new</span> DriverManagerDataSource();</div><div class="line">         </div><div class="line">    dataSource.setDriverClassName(<span class="string">"com.mysql.cj.jdbc.Driver"</span>);</div><div class="line">    dataSource.setUrl(env.getProperty(<span class="string">"mysql.url"</span>));</div><div class="line">    dataSource.setUsername(env.getProperty(<span class="string">"mysql.user"</span>) != <span class="keyword">null</span></div><div class="line">      ? env.getProperty(<span class="string">"mysql.user"</span>) : <span class="string">""</span>);</div><div class="line">    dataSource.setPassword(env.getProperty(<span class="string">"mysql.pass"</span>) != <span class="keyword">null</span></div><div class="line">      ? env.getProperty(<span class="string">"mysql.pass"</span>) : <span class="string">""</span>);</div><div class="line">         </div><div class="line">    <span class="keyword">return</span> dataSource;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>mysql.properties文件将包含usemysql属性：</p>
<blockquote>
<p>usemysql=local</p>
</blockquote>
<p>如果使用MySQLAutoconfiguration的应用程序希望覆盖默认属性，则需要做的就是为mysql.url，mysql.user和mysql.pass属性以及mysql.properties文件中的usemysql = custom 添加不同的值。</p>
<h3 id="3-4-Resource-Conditions"><a href="#3-4-Resource-Conditions" class="headerlink" title="3.4. Resource Conditions"></a><strong>3.4. Resource Conditions</strong></h3><p>添加@ConditionalOnResource注释意味着只有当指定的资源存在时才会加载配置。</p>
<p>让我们定义一个名为additionalProperties（）的方法，该方法将返回一个包含特定于Hibernate的属性的Properties对象，以供entityManagerFactory bean使用，只有当资源文件mysql.properties存在时：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@ConditionalOnResource</span>(</div><div class="line">  resources = <span class="string">"classpath:mysql.properties"</span>)</div><div class="line"><span class="meta">@Conditional</span>(HibernateCondition.class)</div><div class="line"><span class="function">Properties <span class="title">additionalProperties</span><span class="params">()</span> </span>&#123;</div><div class="line">    Properties hibernateProperties = <span class="keyword">new</span> Properties();</div><div class="line"> </div><div class="line">    hibernateProperties.setProperty(<span class="string">"hibernate.hbm2ddl.auto"</span>, </div><div class="line">      env.getProperty(<span class="string">"mysql-hibernate.hbm2ddl.auto"</span>));</div><div class="line">    hibernateProperties.setProperty(<span class="string">"hibernate.dialect"</span>, </div><div class="line">      env.getProperty(<span class="string">"mysql-hibernate.dialect"</span>));</div><div class="line">    hibernateProperties.setProperty(<span class="string">"hibernate.show_sql"</span>, </div><div class="line">      env.getProperty(<span class="string">"mysql-hibernate.show_sql"</span>) != <span class="keyword">null</span></div><div class="line">      ? env.getProperty(<span class="string">"mysql-hibernate.show_sql"</span>) : <span class="string">"false"</span>);</div><div class="line">    <span class="keyword">return</span> hibernateProperties;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<p>我们可以将Hibernate的特定属性添加到mysql.properties文件中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mysql-hibernate.dialect=org.hibernate.dialect.MySQLDialect</div><div class="line">mysql-hibernate.show_sql=<span class="keyword">true</span></div><div class="line">mysql-hibernate.hbm2ddl.auto=create-drop</div></pre></td></tr></table></figure>
<h3 id="3-5-Custom-Conditions"><a href="#3-5-Custom-Conditions" class="headerlink" title="3.5. Custom Conditions"></a><strong>3.5. Custom Conditions</strong></h3><p>如果我们不想使用Spring Boot中可用的任何条件，我们还可以通过扩展Sp​​ringBootCondition类并覆盖getMatchOutcome（）metho来定义自定义条件</p>
<p>我们为我们的additionalProperties（）方法创建一个名为HibernateCondition的条件，该方法将验证类路径中是否存在HibernateEntityManager类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">HibernateCondition</span> <span class="keyword">extends</span> <span class="title">SpringBootCondition</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String[] CLASS_NAMES</div><div class="line">      = &#123; <span class="string">"org.hibernate.ejb.HibernateEntityManager"</span>, </div><div class="line">          <span class="string">"org.hibernate.jpa.HibernateEntityManager"</span> &#125;;</div><div class="line"> </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> ConditionOutcome <span class="title">getMatchOutcome</span><span class="params">(ConditionContext context, </span></span></div><div class="line">      AnnotatedTypeMetadata metadata) &#123;</div><div class="line">  </div><div class="line">        ConditionMessage.Builder message</div><div class="line">          = ConditionMessage.forCondition(<span class="string">"Hibernate"</span>);</div><div class="line">        <span class="keyword">return</span> Arrays.stream(CLASS_NAMES)</div><div class="line">          .filter(className -&gt; ClassUtils.isPresent(className, context.getClassLoader()))</div><div class="line">          .map(className -&gt; ConditionOutcome</div><div class="line">            .match(message.found(<span class="string">"class"</span>)</div><div class="line">            .items(Style.NORMAL, className)))</div><div class="line">          .findAny()</div><div class="line">          .orElseGet(() -&gt; ConditionOutcome</div><div class="line">            .noMatch(message.didNotFind(<span class="string">"class"</span>, <span class="string">"classes"</span>)</div><div class="line">            .items(Style.NORMAL, Arrays.asList(CLASS_NAMES))));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后我们可以将这个条件添加到additionalProperties（）方法中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Conditional</span>(HibernateCondition.class)</div><div class="line"><span class="function">Properties <span class="title">additionalProperties</span><span class="params">()</span> </span>&#123;</div><div class="line">  <span class="comment">//...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3-6-Application-Conditions"><a href="#3-6-Application-Conditions" class="headerlink" title="3.6. Application Conditions"></a><strong>3.6. Application Conditions</strong></h3><p>我们还可以通过添加@ConditionalOnWebApplication或@ConditionalOnNotWebApplication注释来指定配置只能在Web上下文中加载。</p>
<h2 id="4-Testing-the-Auto-Configuration"><a href="#4-Testing-the-Auto-Configuration" class="headerlink" title="4. Testing the Auto-Configuration"></a><strong>4. Testing the Auto-Configuration</strong></h2><p>让我们创建一个非常简单的例子来测试我们的自动配置。我们将创建一个名为MyUser的实体类，使用Spring Data创建一个MyUserRepository接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Entity</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyUser</span> </span>&#123;</div><div class="line">    <span class="meta">@Id</span></div><div class="line">    <span class="keyword">private</span> String email;</div><div class="line"> </div><div class="line">    <span class="comment">// standard constructor, getters, setters</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyUserRepository</span> </span></div><div class="line">  <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">MyUser</span>, <span class="title">String</span>&gt; &#123; &#125;</div></pre></td></tr></table></figure>
<p>要启用自动配置，我们可以使用@SpringBootApplication或@EnableAutoConfiguration注释之一：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@SpringBootApplication</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AutoconfigurationApplication</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        SpringApplication.run(AutoconfigurationApplication.class, args);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>接下来，让我们写一个JUnit测试可以保存MYUSER实体：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class="line"><span class="meta">@SpringBootTest</span>(</div><div class="line">  classes = AutoconfigurationApplication.class)</div><div class="line"><span class="meta">@EnableJpaRepositories</span>(</div><div class="line">  basePackages = &#123; <span class="string">"com.baeldung.autoconfiguration.example"</span> &#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AutoconfigurationTest</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> MyUserRepository userRepository;</div><div class="line"> </div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenSaveUser_thenOk</span><span class="params">()</span> </span>&#123;</div><div class="line">        MyUser user = <span class="keyword">new</span> MyUser(<span class="string">"user@email.com"</span>);</div><div class="line">        userRepository.save(user);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>由于我们尚未定义DataSource配置，因此应用程序将使用我们创建的自动配置来连接到名为myDb的MySQL数据库。</p>
<p>连接字符串包含createDatabaseIfNotExist = true属性，因此数据库不需要存在。但是，用户mysqluser或通过mysql.user属性指定的用户，如果存在，则需要创建。</p>
<p>我们可以检查应用程序日志以查看正在使用的MySQL数据源：</p>
<blockquote>
<p>web - 2017-04-12 00:01:33,956 [main] INFO  o.s.j.d.DriverManagerDataSource - Loaded JDBC driver: com.mysql.cj.jdbc.Driver</p>
</blockquote>
<h2 id="5-Disabling-Auto-Configuration-Classes"><a href="#5-Disabling-Auto-Configuration-Classes" class="headerlink" title="5. Disabling Auto-Configuration Classes"></a><strong>5. Disabling Auto-Configuration Classes</strong></h2><p>如果我们想排除自动配置加载，我们可以将@EnableAutoConfiguration注释与exclude或excludeName属性添加到配置类中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="meta">@EnableAutoConfiguration</span>(</div><div class="line">  exclude=&#123;MySQLAutoconfiguration.class&#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AutoconfigurationApplication</span> </span>&#123;</div><div class="line">    <span class="comment">//...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>禁用特定自动配置的另一个选项是设置spring.autoconfigure.exclude属性：</p>
<blockquote>
<p>spring.autoconfigure.exclude=com.baeldung.autoconfiguration.MySQLAutoconfiguration</p>
</blockquote>
<h2 id="6-Conclusions"><a href="#6-Conclusions" class="headerlink" title="6. Conclusions"></a><strong>6. Conclusions</strong></h2><p>在本教程中，我们展示了如何创建自定义的Spring Boot自动配置。该示例的完整源代码可以在GitHub上找到。 可以使用自动配置配置文件运行JUnit测试：mvn clean install -Pautoconfiguration。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">spring</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/06/22/使用Spring Boot创建自定义自动配置/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-Implementing a Custom Spring AOP Annotation" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/18/Implementing a Custom Spring AOP Annotation/">Implementing a Custom Spring AOP Annotation</a>
    </h1>
  

        
        <a href="/2017/06/18/Implementing a Custom Spring AOP Annotation/" class="archive-article-date">
  	<time datetime="2017-06-18T14:55:13.900Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-06-18</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a><strong>1. Introduction</strong></h1><p>在本文中，我们将使用Spring中的AOP支持来实现自定义AOP注释。</p>
<p>首先，我们将对AOP进行高级概述，说明它是什么以及它的优点。接下来，我们将逐步实施注释，逐步建立对AOP概念的更深入的了解。 结果将是对AOP的更好理解和将来创建我们的定制Spring注释的能力。</p>
<h1 id="2-What-is-an-AOP-Annotation"><a href="#2-What-is-an-AOP-Annotation" class="headerlink" title="2. What is an AOP Annotation?"></a><strong>2. What is an AOP Annotation?</strong></h1><p>要快速总结，AOP代表面向方面的编程。基本上，它是一种在不修改该代码的情况下向现有代码添加行为的方式。 有关AOP的详细介绍，有关于AOP切入点和建议的文章。本文假设我们已经有了基础知识</p>
<p>我们将在本文中实现的AOP的类型是注释驱动的。如果我们使用了Spring @Transactional注释，我们可能已经熟悉了这一点：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Transactional</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">orderGoods</span><span class="params">(Order order)</span> </span>&#123;</div><div class="line">   <span class="comment">// A series of database calls to be performed in a transaction</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里的关键是非侵略性。通过使用注解元数据，我们的核心业务逻辑不会被我们的交易代码污染。这使得更容易理解，重构和隔离测试。</p>
<p>有时，开发Spring应用程序的人可以将其看作是“弹性魔法”，而不必考虑如何运作。在现实中，发生的事情并不是特别复杂。但是，一旦我们完成了本文中的步骤，我们将能够创建自己的自定义注释，以了解和利用AOP。</p>
<h1 id="3-Maven-Dependency"><a href="#3-Maven-Dependency" class="headerlink" title="3. Maven Dependency"></a><strong>3. Maven Dependency</strong></h1><p>首先，我们添加我们的Maven依赖关系。 对于这个例子，我们将使用Spring Boot，因为它的配置方法的惯例让我们尽可能快地起床和运行：</p>
<figure class="highlight vbscript-html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;parent&gt;</div><div class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;1.5.2.RELEASE&lt;/version&gt;</div><div class="line">&lt;/parent&gt;</div><div class="line"> </div><div class="line">&lt;dependencies&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line">&lt;/dependencies&gt;</div></pre></td></tr></table></figure>
<p>请注意，我们已经包括了AOP启动器，它引入了我们开始实现方面所需的库。</p>
<h1 id="4-Creating-our-Custom-Annotation"><a href="#4-Creating-our-Custom-Annotation" class="headerlink" title="4. Creating our Custom Annotation"></a><strong>4. Creating our Custom Annotation</strong></h1><p>我们要创建的注释是用于记录执行方法所需的时间量的注释。我们创建我们的注释：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Target</span>(ElementType.METHOD)</div><div class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</div><div class="line"><span class="keyword">public</span> <span class="meta">@interface</span> LogExecutionTime &#123;</div><div class="line"> </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>虽然相对简单的实现，值得注意的是使用两个元注释。</p>
<p>@Target注释告诉我们我们的注释将适用于何处。在这里我们使用ElementType.Method，这意味着它只适用于方法。如果我们试图在其他地方使用注释，那么我们的代码将无法编译。这种行为是有道理的，因为我们的注释将用于记录方法执行时间。</p>
<p>而@Retention只是说明注释是否在运行时可用于JVM。默认情况下不是这样，所以Spring AOP将无法看到注释。这就是为什么它被重新配置。</p>
<h1 id="5-Creating-our-Aspect"><a href="#5-Creating-our-Aspect" class="headerlink" title="5. Creating our Aspect"></a><strong>5. Creating our Aspect</strong></h1><p>现在我们有了我们的注释，我们来创建我们的方面。这只是封装我们交叉关切的模块，我们的方法是执行时间记录。它是一个类，用@Aspect注释：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Aspect</span></div><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleAspect</span> </span>&#123;</div><div class="line"> </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="6-Creating-our-Pointcut-and-Advice"><a href="#6-Creating-our-Pointcut-and-Advice" class="headerlink" title="6. Creating our Pointcut and Advice"></a><strong>6. Creating our Pointcut and Advice</strong></h1><p>现在，我们来创建我们的切入点和建议。这将是一个注释的方法，它存在于我们的方面：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Around</span>(<span class="string">"@annotation(LogExecutionTime)"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">logExecutionTime</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">    <span class="keyword">return</span> joinPoint.proceed();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>从技术上讲，这并没有改变任何事情的行为，但仍然有很多需求分析。</p>
<p>首先，我们用@Around注释了我们的方法。这是我们的建议，围绕建议意味着我们在方法执行之前和之后添加额外的代码。还有其他类型的建议，例如前后，但这些建议将被排除在本文的范围之外。</p>
<p>接下来，我们的@Around注释有一个切点参数。我们的切入点只是说，’应用这个建议任何方法用@LogExecutionTime注释’。还有很多其他类型的切入点，但是如果范围，它们将再次被忽略。</p>
<p>方法logExecutionTime（）本身就是我们的建议。有一个参数，即ProceedingJoinPoint。在我们的例子中，这将是一个已经用@LogExecutionTime注释的执行方法。</p>
<p>最后，当我们的注释方法最终被调用时，会发生什么，我们的建议将被首先调用。那么由我们的建议决定下一步做什么。在我们的例子中，我们的建议是除了调用proceed（）之外什么也没做，只是调用原来的注释方法。</p>
<h1 id="7-Logging-our-Execution-Time"><a href="#7-Logging-our-Execution-Time" class="headerlink" title="7. Logging our Execution Time"></a><strong>7. Logging our Execution Time</strong></h1><p>现在我们有了我们的骨架，我们需要做的就是为我们的建议添加一些额外的逻辑。除了调用原始方法之外，这将记录执行时间。让我们再补充一点：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Around</span>(<span class="string">"@annotation(LogExecutionTime)"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">logExecutionTime</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">    <span class="keyword">long</span> start = System.currentTimeMillis();</div><div class="line"> </div><div class="line">    Object proceed = joinPoint.proceed();</div><div class="line"> </div><div class="line">    <span class="keyword">long</span> executionTime = System.currentTimeMillis() - start;</div><div class="line"> </div><div class="line">    System.out.println(joinPoint.getSignature() + <span class="string">" executed in "</span> + executionTime + <span class="string">"ms"</span>);</div><div class="line">    <span class="keyword">return</span> proceed;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>再次，我们没有做任何在这里特别复杂的事情。我们刚刚记录了当前的时间，执行了该方法，然后打印出控制台所需的时间。我们还记录了使用连接点实例提供的方法签名。如果我们想要，我们也可以访问其他信息位，例如方法参数。</p>
<p>现在，让我们尝试用@LogExecutionTime注释一个方法，然后执行它来看看会发生什么。请注意，这必须是一个Spring Bean才能正常工作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@LogExecutionTime</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">serve</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">    Thread.sleep(<span class="number">2000</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>执行后，我们应该看到以下记录到控制台：</p>
<blockquote>
<p>void org.baeldung.Service.serve() executed in 2030ms</p>
</blockquote>
<h1 id="8-Conclusion"><a href="#8-Conclusion" class="headerlink" title="8. Conclusion"></a><strong>8. Conclusion</strong></h1><p>在本文中，我们利用Spring Boot AOP创建自定义注释，我们可以将其应用于Spring bean，以便在运行时向其注入额外的行为。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">spring</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/06/18/Implementing a Custom Spring AOP Annotation/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
    </nav>
  


          </div>
        </div>
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 marnner
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		mathjax: false,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true,
		showTags: true
	}
</script>

<script>!function(t){function n(r){if(e[r])return e[r].exports;var o=e[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var e={};n.m=t,n.c=e,n.p="./",n(0)}([function(t,n,e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,n){var e=/\/|index.html/g;return t.replace(e,"")===n.replace(e,"")}function i(){for(var t=document.querySelectorAll(".js-header-menu li a"),n=window.location.pathname,e=0,r=t.length;e<r;e++){var i=t[e];o(n,i.getAttribute("href"))&&(0,p.default)(i,"active")}}function u(t){for(var n=t.offsetLeft,e=t.offsetParent;null!==e;)n+=e.offsetLeft,e=e.offsetParent;return n}function c(t){for(var n=t.offsetTop,e=t.offsetParent;null!==e;)n+=e.offsetTop,e=e.offsetParent;return n}function f(t,n,e,r,o){var i=u(t),f=c(t)-n;if(f-e<=o){var a=t.$newDom;a||(a=t.cloneNode(!0),(0,v.default)(t,a),t.$newDom=a,a.style.position="fixed",a.style.top=(e||f)+"px",a.style.left=i+"px",a.style.zIndex=r||2,a.style.width="100%",a.style.color="#fff"),a.style.visibility="visible",t.style.visibility="hidden"}else{t.style.visibility="visible";var s=t.$newDom;s&&(s.style.visibility="hidden")}}function a(){var t=document.querySelector(".js-overlay"),n=document.querySelector(".js-header-menu");f(t,document.body.scrollTop,-63,2,0),f(n,document.body.scrollTop,1,3,0)}function s(){document.querySelector("#container").addEventListener("scroll",function(t){a()}),window.addEventListener("scroll",function(t){a()}),a()}var l=e(25),p=r(l),d=e(26),y=(r(d),e(96)),v=r(y),h=e(97),b=r(h),x=e(98),m=r(x),g=e(27);!function(){b.default.versions.mobile&&window.screen.width<800&&(i(),s())}(),(0,g.addLoadEvent)(function(){m.default.init()}),t.exports={}},,,,,,,,,,,,,,,,,,,,,,,,,function(t,n){function e(t,n){t.classList?t.classList.add(n):t.className+=" "+n}t.exports=e},function(t,n){function e(t,n){if(t.classList)t.classList.remove(n);else{var e=new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi");t.className=t.className.replace(e," ")}}t.exports=e},function(t,n,e){"use strict";var r=e(28),o=function(t){return t&&t.__esModule?t:{default:t}}(r),i=function(){function t(t,n,r){return n||r?String.fromCharCode(n||r):e[t]||t}function n(t){return r[t]}var e={"&quot;":'"',"&lt;":"<","&gt;":">","&amp;":"&","&nbsp;":" "},r={};for(var u in e)r[e[u]]=u;return e["&apos;"]="'",r["'"]="&#39;",{encode:function(t){return t?(""+t).replace(/['<> "&]/g,n).replace(/\r?\n/g,"<br/>").replace(/\s/g,"&nbsp;"):""},decode:function(n){return n?(""+n).replace(/<br\s*\/?>/gi,"\n").replace(/&quot;|&lt;|&gt;|&amp;|&nbsp;|&apos;|&#(\d+);|&#(\d+)/g,t).replace(/\u00a0/g," "):""},encodeBase16:function(t){if(!t)return t;t+="";for(var n=[],e=0,r=t.length;r>e;e++)n.push(t.charCodeAt(e).toString(16).toUpperCase());return n.join("")},encodeBase16forJSON:function(t){if(!t)return t;t=t.replace(/[\u4E00-\u9FBF]/gi,function(t){return escape(t).replace("%u","\\u")});for(var n=[],e=0,r=t.length;r>e;e++)n.push(t.charCodeAt(e).toString(16).toUpperCase());return n.join("")},decodeBase16:function(t){if(!t)return t;t+="";for(var n=[],e=0,r=t.length;r>e;e+=2)n.push(String.fromCharCode("0x"+t.slice(e,e+2)));return n.join("")},encodeObject:function(t){if(t instanceof Array)for(var n=0,e=t.length;e>n;n++)t[n]=i.encodeObject(t[n]);else if("object"==(void 0===t?"undefined":(0,o.default)(t)))for(var r in t)t[r]=i.encodeObject(t[r]);else if("string"==typeof t)return i.encode(t);return t},loadScript:function(t){var n=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(n),n.setAttribute("src",t)},addLoadEvent:function(t){var n=window.onload;"function"!=typeof window.onload?window.onload=t:window.onload=function(){n(),t()}}}}();t.exports=i},function(t,n,e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}n.__esModule=!0;var o=e(29),i=r(o),u=e(80),c=r(u),f="function"==typeof c.default&&"symbol"==typeof i.default?function(t){return typeof t}:function(t){return t&&"function"==typeof c.default&&t.constructor===c.default&&t!==c.default.prototype?"symbol":typeof t};n.default="function"==typeof c.default&&"symbol"===f(i.default)?function(t){return void 0===t?"undefined":f(t)}:function(t){return t&&"function"==typeof c.default&&t.constructor===c.default&&t!==c.default.prototype?"symbol":void 0===t?"undefined":f(t)}},function(t,n,e){t.exports={default:e(30),__esModule:!0}},function(t,n,e){e(31),e(75),t.exports=e(79).f("iterator")},function(t,n,e){"use strict";var r=e(32)(!0);e(35)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,e=this._i;return e>=n.length?{value:void 0,done:!0}:(t=r(n,e),this._i+=t.length,{value:t,done:!1})})},function(t,n,e){var r=e(33),o=e(34);t.exports=function(t){return function(n,e){var i,u,c=String(o(n)),f=r(e),a=c.length;return f<0||f>=a?t?"":void 0:(i=c.charCodeAt(f),i<55296||i>56319||f+1===a||(u=c.charCodeAt(f+1))<56320||u>57343?t?c.charAt(f):i:t?c.slice(f,f+2):u-56320+(i-55296<<10)+65536)}}},function(t,n){var e=Math.ceil,r=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?r:e)(t)}},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n,e){"use strict";var r=e(36),o=e(37),i=e(52),u=e(42),c=e(53),f=e(54),a=e(55),s=e(71),l=e(73),p=e(72)("iterator"),d=!([].keys&&"next"in[].keys()),y=function(){return this};t.exports=function(t,n,e,v,h,b,x){a(e,n,v);var m,g,w,O=function(t){if(!d&&t in P)return P[t];switch(t){case"keys":return function(){return new e(this,t)};case"values":return function(){return new e(this,t)}}return function(){return new e(this,t)}},S=n+" Iterator",_="values"==h,j=!1,P=t.prototype,E=P[p]||P["@@iterator"]||h&&P[h],M=E||O(h),A=h?_?O("entries"):M:void 0,T="Array"==n?P.entries||E:E;if(T&&(w=l(T.call(new t)))!==Object.prototype&&(s(w,S,!0),r||c(w,p)||u(w,p,y)),_&&E&&"values"!==E.name&&(j=!0,M=function(){return E.call(this)}),r&&!x||!d&&!j&&P[p]||u(P,p,M),f[n]=M,f[S]=y,h)if(m={values:_?M:O("values"),keys:b?M:O("keys"),entries:A},x)for(g in m)g in P||i(P,g,m[g]);else o(o.P+o.F*(d||j),n,m);return m}},function(t,n){t.exports=!0},function(t,n,e){var r=e(38),o=e(39),i=e(40),u=e(42),c=function(t,n,e){var f,a,s,l=t&c.F,p=t&c.G,d=t&c.S,y=t&c.P,v=t&c.B,h=t&c.W,b=p?o:o[n]||(o[n]={}),x=b.prototype,m=p?r:d?r[n]:(r[n]||{}).prototype;p&&(e=n);for(f in e)(a=!l&&m&&void 0!==m[f])&&f in b||(s=a?m[f]:e[f],b[f]=p&&"function"!=typeof m[f]?e[f]:v&&a?i(s,r):h&&m[f]==s?function(t){var n=function(n,e,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,e)}return new t(n,e,r)}return t.apply(this,arguments)};return n.prototype=t.prototype,n}(s):y&&"function"==typeof s?i(Function.call,s):s,y&&((b.virtual||(b.virtual={}))[f]=s,t&c.R&&x&&!x[f]&&u(x,f,s)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,t.exports=c},function(t,n){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)},function(t,n){var e=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=e)},function(t,n,e){var r=e(41);t.exports=function(t,n,e){if(r(t),void 0===n)return t;switch(e){case 1:return function(e){return t.call(n,e)};case 2:return function(e,r){return t.call(n,e,r)};case 3:return function(e,r,o){return t.call(n,e,r,o)}}return function(){return t.apply(n,arguments)}}},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n,e){var r=e(43),o=e(51);t.exports=e(47)?function(t,n,e){return r.f(t,n,o(1,e))}:function(t,n,e){return t[n]=e,t}},function(t,n,e){var r=e(44),o=e(46),i=e(50),u=Object.defineProperty;n.f=e(47)?Object.defineProperty:function(t,n,e){if(r(t),n=i(n,!0),r(e),o)try{return u(t,n,e)}catch(t){}if("get"in e||"set"in e)throw TypeError("Accessors not supported!");return"value"in e&&(t[n]=e.value),t}},function(t,n,e){var r=e(45);t.exports=function(t){if(!r(t))throw TypeError(t+" is not an object!");return t}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n,e){t.exports=!e(47)&&!e(48)(function(){return 7!=Object.defineProperty(e(49)("div"),"a",{get:function(){return 7}}).a})},function(t,n,e){t.exports=!e(48)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n,e){var r=e(45),o=e(38).document,i=r(o)&&r(o.createElement);t.exports=function(t){return i?o.createElement(t):{}}},function(t,n,e){var r=e(45);t.exports=function(t,n){if(!r(t))return t;var e,o;if(n&&"function"==typeof(e=t.toString)&&!r(o=e.call(t)))return o;if("function"==typeof(e=t.valueOf)&&!r(o=e.call(t)))return o;if(!n&&"function"==typeof(e=t.toString)&&!r(o=e.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n,e){t.exports=e(42)},function(t,n){var e={}.hasOwnProperty;t.exports=function(t,n){return e.call(t,n)}},function(t,n){t.exports={}},function(t,n,e){"use strict";var r=e(56),o=e(51),i=e(71),u={};e(42)(u,e(72)("iterator"),function(){return this}),t.exports=function(t,n,e){t.prototype=r(u,{next:o(1,e)}),i(t,n+" Iterator")}},function(t,n,e){var r=e(44),o=e(57),i=e(69),u=e(66)("IE_PROTO"),c=function(){},f=function(){var t,n=e(49)("iframe"),r=i.length;for(n.style.display="none",e(70).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),f=t.F;r--;)delete f.prototype[i[r]];return f()};t.exports=Object.create||function(t,n){var e;return null!==t?(c.prototype=r(t),e=new c,c.prototype=null,e[u]=t):e=f(),void 0===n?e:o(e,n)}},function(t,n,e){var r=e(43),o=e(44),i=e(58);t.exports=e(47)?Object.defineProperties:function(t,n){o(t);for(var e,u=i(n),c=u.length,f=0;c>f;)r.f(t,e=u[f++],n[e]);return t}},function(t,n,e){var r=e(59),o=e(69);t.exports=Object.keys||function(t){return r(t,o)}},function(t,n,e){var r=e(53),o=e(60),i=e(63)(!1),u=e(66)("IE_PROTO");t.exports=function(t,n){var e,c=o(t),f=0,a=[];for(e in c)e!=u&&r(c,e)&&a.push(e);for(;n.length>f;)r(c,e=n[f++])&&(~i(a,e)||a.push(e));return a}},function(t,n,e){var r=e(61),o=e(34);t.exports=function(t){return r(o(t))}},function(t,n,e){var r=e(62);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==r(t)?t.split(""):Object(t)}},function(t,n){var e={}.toString;t.exports=function(t){return e.call(t).slice(8,-1)}},function(t,n,e){var r=e(60),o=e(64),i=e(65);t.exports=function(t){return function(n,e,u){var c,f=r(n),a=o(f.length),s=i(u,a);if(t&&e!=e){for(;a>s;)if((c=f[s++])!=c)return!0}else for(;a>s;s++)if((t||s in f)&&f[s]===e)return t||s||0;return!t&&-1}}},function(t,n,e){var r=e(33),o=Math.min;t.exports=function(t){return t>0?o(r(t),9007199254740991):0}},function(t,n,e){var r=e(33),o=Math.max,i=Math.min;t.exports=function(t,n){return t=r(t),t<0?o(t+n,0):i(t,n)}},function(t,n,e){var r=e(67)("keys"),o=e(68);t.exports=function(t){return r[t]||(r[t]=o(t))}},function(t,n,e){var r=e(38),o=r["__core-js_shared__"]||(r["__core-js_shared__"]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,n){var e=0,r=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++e+r).toString(36))}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n,e){t.exports=e(38).document&&document.documentElement},function(t,n,e){var r=e(43).f,o=e(53),i=e(72)("toStringTag");t.exports=function(t,n,e){t&&!o(t=e?t:t.prototype,i)&&r(t,i,{configurable:!0,value:n})}},function(t,n,e){var r=e(67)("wks"),o=e(68),i=e(38).Symbol,u="function"==typeof i;(t.exports=function(t){return r[t]||(r[t]=u&&i[t]||(u?i:o)("Symbol."+t))}).store=r},function(t,n,e){var r=e(53),o=e(74),i=e(66)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=o(t),r(t,i)?t[i]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n,e){var r=e(34);t.exports=function(t){return Object(r(t))}},function(t,n,e){e(76);for(var r=e(38),o=e(42),i=e(54),u=e(72)("toStringTag"),c=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],f=0;f<5;f++){var a=c[f],s=r[a],l=s&&s.prototype;l&&!l[u]&&o(l,u,a),i[a]=i.Array}},function(t,n,e){"use strict";var r=e(77),o=e(78),i=e(54),u=e(60);t.exports=e(35)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,e=this._i++;return!t||e>=t.length?(this._t=void 0,o(1)):"keys"==n?o(0,e):"values"==n?o(0,t[e]):o(0,[e,t[e]])},"values"),i.Arguments=i.Array,r("keys"),r("values"),r("entries")},function(t,n){t.exports=function(){}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,e){n.f=e(72)},function(t,n,e){t.exports={default:e(81),__esModule:!0}},function(t,n,e){e(82),e(93),e(94),e(95),t.exports=e(39).Symbol},function(t,n,e){"use strict";var r=e(38),o=e(53),i=e(47),u=e(37),c=e(52),f=e(83).KEY,a=e(48),s=e(67),l=e(71),p=e(68),d=e(72),y=e(79),v=e(84),h=e(85),b=e(86),x=e(89),m=e(44),g=e(60),w=e(50),O=e(51),S=e(56),_=e(90),j=e(92),P=e(43),E=e(58),M=j.f,A=P.f,T=_.f,L=r.Symbol,N=r.JSON,C=N&&N.stringify,k=d("_hidden"),F=d("toPrimitive"),q={}.propertyIsEnumerable,I=s("symbol-registry"),B=s("symbols"),D=s("op-symbols"),W=Object.prototype,H="function"==typeof L,K=r.QObject,R=!K||!K.prototype||!K.prototype.findChild,J=i&&a(function(){return 7!=S(A({},"a",{get:function(){return A(this,"a",{value:7}).a}})).a})?function(t,n,e){var r=M(W,n);r&&delete W[n],A(t,n,e),r&&t!==W&&A(W,n,r)}:A,U=function(t){var n=B[t]=S(L.prototype);return n._k=t,n},G=H&&"symbol"==typeof L.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof L},$=function(t,n,e){return t===W&&$(D,n,e),m(t),n=w(n,!0),m(e),o(B,n)?(e.enumerable?(o(t,k)&&t[k][n]&&(t[k][n]=!1),e=S(e,{enumerable:O(0,!1)})):(o(t,k)||A(t,k,O(1,{})),t[k][n]=!0),J(t,n,e)):A(t,n,e)},z=function(t,n){m(t);for(var e,r=b(n=g(n)),o=0,i=r.length;i>o;)$(t,e=r[o++],n[e]);return t},Y=function(t,n){return void 0===n?S(t):z(S(t),n)},Q=function(t){var n=q.call(this,t=w(t,!0));return!(this===W&&o(B,t)&&!o(D,t))&&(!(n||!o(this,t)||!o(B,t)||o(this,k)&&this[k][t])||n)},X=function(t,n){if(t=g(t),n=w(n,!0),t!==W||!o(B,n)||o(D,n)){var e=M(t,n);return!e||!o(B,n)||o(t,k)&&t[k][n]||(e.enumerable=!0),e}},V=function(t){for(var n,e=T(g(t)),r=[],i=0;e.length>i;)o(B,n=e[i++])||n==k||n==f||r.push(n);return r},Z=function(t){for(var n,e=t===W,r=T(e?D:g(t)),i=[],u=0;r.length>u;)!o(B,n=r[u++])||e&&!o(W,n)||i.push(B[n]);return i};H||(L=function(){if(this instanceof L)throw TypeError("Symbol is not a constructor!");var t=p(arguments.length>0?arguments[0]:void 0),n=function(e){this===W&&n.call(D,e),o(this,k)&&o(this[k],t)&&(this[k][t]=!1),J(this,t,O(1,e))};return i&&R&&J(W,t,{configurable:!0,set:n}),U(t)},c(L.prototype,"toString",function(){return this._k}),j.f=X,P.f=$,e(91).f=_.f=V,e(88).f=Q,e(87).f=Z,i&&!e(36)&&c(W,"propertyIsEnumerable",Q,!0),y.f=function(t){return U(d(t))}),u(u.G+u.W+u.F*!H,{Symbol:L});for(var tt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),nt=0;tt.length>nt;)d(tt[nt++]);for(var tt=E(d.store),nt=0;tt.length>nt;)v(tt[nt++]);u(u.S+u.F*!H,"Symbol",{for:function(t){return o(I,t+="")?I[t]:I[t]=L(t)},keyFor:function(t){if(G(t))return h(I,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){R=!0},useSimple:function(){R=!1}}),u(u.S+u.F*!H,"Object",{create:Y,defineProperty:$,defineProperties:z,getOwnPropertyDescriptor:X,getOwnPropertyNames:V,getOwnPropertySymbols:Z}),N&&u(u.S+u.F*(!H||a(function(){var t=L();return"[null]"!=C([t])||"{}"!=C({a:t})||"{}"!=C(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!G(t)){for(var n,e,r=[t],o=1;arguments.length>o;)r.push(arguments[o++]);return n=r[1],"function"==typeof n&&(e=n),!e&&x(n)||(n=function(t,n){if(e&&(n=e.call(this,t,n)),!G(n))return n}),r[1]=n,C.apply(N,r)}}}),L.prototype[F]||e(42)(L.prototype,F,L.prototype.valueOf),l(L,"Symbol"),l(Math,"Math",!0),l(r.JSON,"JSON",!0)},function(t,n,e){var r=e(68)("meta"),o=e(45),i=e(53),u=e(43).f,c=0,f=Object.isExtensible||function(){return!0},a=!e(48)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,r,{value:{i:"O"+ ++c,w:{}}})},l=function(t,n){if(!o(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!i(t,r)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[r].i},p=function(t,n){if(!i(t,r)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[r].w},d=function(t){return a&&y.NEED&&f(t)&&!i(t,r)&&s(t),t},y=t.exports={KEY:r,NEED:!1,fastKey:l,getWeak:p,onFreeze:d}},function(t,n,e){var r=e(38),o=e(39),i=e(36),u=e(79),c=e(43).f;t.exports=function(t){var n=o.Symbol||(o.Symbol=i?{}:r.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,e){var r=e(58),o=e(60);t.exports=function(t,n){for(var e,i=o(t),u=r(i),c=u.length,f=0;c>f;)if(i[e=u[f++]]===n)return e}},function(t,n,e){var r=e(58),o=e(87),i=e(88);t.exports=function(t){var n=r(t),e=o.f;if(e)for(var u,c=e(t),f=i.f,a=0;c.length>a;)f.call(t,u=c[a++])&&n.push(u);return n}},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,e){var r=e(62);t.exports=Array.isArray||function(t){return"Array"==r(t)}},function(t,n,e){var r=e(60),o=e(91).f,i={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],c=function(t){try{return o(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==i.call(t)?c(t):o(r(t))}},function(t,n,e){var r=e(59),o=e(69).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return r(t,o)}},function(t,n,e){var r=e(88),o=e(51),i=e(60),u=e(50),c=e(53),f=e(46),a=Object.getOwnPropertyDescriptor;n.f=e(47)?a:function(t,n){if(t=i(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return o(!r.f.call(t,n),t[n])}},function(t,n){},function(t,n,e){e(84)("asyncIterator")},function(t,n,e){e(84)("observable")},function(t,n){function e(t,n){if("string"==typeof n)return t.insertAdjacentHTML("afterend",n);var e=t.nextSibling;return e?t.parentNode.insertBefore(n,e):t.parentNode.appendChild(n)}t.exports=e},function(t,n){"use strict";var e={versions:function(){var t=window.navigator.userAgent;return{trident:t.indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&t.indexOf("KHTML")==-1,mobile:!!t.match(/AppleWebKit.*Mobile.*/),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1||t.indexOf("Mac")>-1,iPad:t.indexOf("iPad")>-1,webApp:t.indexOf("Safari")==-1,weixin:t.indexOf("MicroMessenger")==-1}}()};t.exports=e},function(t,n){"use strict";function e(){var t=document.querySelector("#page-nav");if(t&&!document.querySelector("#page-nav .extend.prev")&&(t.innerHTML='<a class="extend prev disabled" rel="prev">&laquo; Prev</a>'+t.innerHTML),t&&!document.querySelector("#page-nav .extend.next")&&(t.innerHTML=t.innerHTML+'<a class="extend next disabled" rel="next">Next &raquo;</a>'),yiliaConfig&&yiliaConfig.open_in_new){document.querySelectorAll(".article-entry a:not(.article-more-a)").forEach(function(t){t.setAttribute("target","_blank")})}var n=document.querySelector("#js-aboutme");n&&0!==n.length&&(n.innerHTML=n.innerText)}t.exports={init:e}}])</script><script src="/./main.ea2298.js"></script><script>!function(){!function(e){var t=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(t),t.setAttribute("src",e)}("/slider.583eaa.js")}()</script>


    
<div class="tools-col" q-class="show:isShow,hide:isShow|isFalse" q-on="click:stop(e)">
  <div class="tools-nav header-menu">
    
    
      
      
      
    
      
      
      
    
      
      
      
    
    

    <ul style="width: 70%">
    
    
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'innerArchive')"><a href="javascript:void(0)" q-class="active:innerArchive">所有文章</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'friends')"><a href="javascript:void(0)" q-class="active:friends">友链</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'aboutme')"><a href="javascript:void(0)" q-class="active:aboutme">关于我</a></li>
      
        
    </ul>
  </div>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all" q-show="innerArchive">
        <div class="search-wrap">
          <input class="search-ipt" q-model="search" type="text" placeholder="find something…">
          <i class="icon-search icon" q-show="search|isEmptyStr"></i>
          <i class="icon-close icon" q-show="search|isNotEmptyStr" q-on="click:clearChose(e)"></i>
        </div>
        <div class="widget tagcloud search-tag">
          <p class="search-tag-wording">tag:</p>
          <label class="search-switch">
            <input type="checkbox" q-on="click:toggleTag(e)" q-attr="checked:showTags">
          </label>
          <ul class="article-tag-list" q-show="showTags">
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">spring,springmvc</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">spring</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">rest with spring</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">git</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">HTTP</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">programming</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">spring,aop</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">JVM</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">java</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">java,JPA</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">springboot mybatis</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">Web开发</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">springSecurity</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">javascript</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">java,注解</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">java,volatile</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">undertow</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">Rxjs</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">Git</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">english learn</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">设计模式</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">微服务</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">internet</a>
              </li>
            
            <div class="clearfix"></div>
          </ul>
        </div>
        <ul class="search-ul">
          <p q-show="jsonFail" style="padding: 20px; font-size: 12px;">
            缺失模块。<br/>1、在博客根目录（注意不是yilia根目录）执行以下命令：<br/> npm i hexo-generator-json-content --save<br/><br/>
            2、在根目录_config.yml里添加配置：
<pre style="font-size: 12px;" q-show="jsonFail">
  jsonContent:
    meta: false
    pages: false
    posts:
      title: true
      date: true
      path: true
      text: true
      raw: false
      content: false
      slug: false
      updated: false
      comments: false
      link: false
      permalink: false
      excerpt: false
      categories: false
      tags: true
</pre>
          </p>
          <li class="search-li" q-repeat="items" q-show="isShow">
            <a q-attr="href:path|urlformat" class="search-title"><i class="icon-quo-left icon"></i><span q-text="title"></span></a>
            <p class="search-time">
              <i class="icon-calendar icon"></i>
              <span q-text="date|dateformat"></span>
            </p>
            <p class="search-tag">
              <i class="icon-price-tags icon"></i>
              <span q-repeat="tags" q-on="click:choseTag(e, name)" q-text="name|tagformat"></span>
            </p>
          </li>
        </ul>
    	</section>
    

    
    	<section class="tools-section tools-section-friends" q-show="friends">
  		
        <ul class="search-ul">
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接1</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接2</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接3</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接4</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接5</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接6</a>
            </li>
          
        </ul>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me" q-show="aboutme">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">爱一丹&lt;br&gt;&lt;br&gt; 爱生活</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>