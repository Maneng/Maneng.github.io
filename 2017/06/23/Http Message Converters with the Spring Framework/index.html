<!DOCTYPE html>
<html lang="zh">
    <head>
    <!-- 
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.3.0 -->

    <!-- Title -->
    
    <title>
        
            Http Message Converters with the Spring Framework | 
        
        Marnner
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Meta & Info -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="marnner">
    <meta name="description" content="Just do it">
    <meta name="keywords" content="null,spring">

    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Marnner">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://yoursite.com">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Http Message Converters with the Spring Framework | Marnner">
    <meta property="og:description" content="Just do it">
    <meta property="og:article:tag" content="spring"> 

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import CSS -->
    <link rel="stylesheet" href="/css/material.min.css">
    <link rel="stylesheet" href="/css/style.min.css">
    <!-- Config CSS -->


<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }
</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>



    <script src="/js/jquery.min.js"></script>
    <script src="/js/queue.js"></script>

    <!-- UC Browser Compatible -->
    <script>
        var agent = navigator.userAgent.toLowerCase();
        if(agent.indexOf('ucbrowser')>0) {
            document.write("<link rel=\"stylesheet\" href=\"/css/uc.css\">");
            alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
        }
    </script>

    

    

    <!-- Bing Background -->
    

    <!-- Custom Head -->
    
</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-Overview"><span class="post-toc-number">1.</span> <span class="post-toc-text">1. Overview</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-The-Basics"><span class="post-toc-number">2.</span> <span class="post-toc-text">2. The Basics</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-2-The-Default-Message-Converters"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">2.2. The Default Message Converters</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#3-Client-Server-Communication-–-JSON-only"><span class="post-toc-number">3.</span> <span class="post-toc-text">3. Client-Server Communication – JSON only</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-1-High-Level-Content-Negotiation"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">3.1. High Level Content Negotiation</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-2-ResponseBody"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">3.2. @ResponseBody</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-3-RequestBody"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">3.3. @RequestBody</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#4-Custom-Converters-Configuration"><span class="post-toc-number">4.</span> <span class="post-toc-text">4. Custom Converters Configuration</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5-Using-Spring’s-RestTemplate-with-Http-Message-Converters"><span class="post-toc-number">5.</span> <span class="post-toc-text">5. Using Spring’s RestTemplate with Http Message Converters</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-1-Retrieving-the-Resource-with-no-Accept-Header"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">5.1. Retrieving the Resource with no Accept Header</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-3-Retrieving-a-Resource-with-application-json-Accept-header"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">5.3. Retrieving a Resource with application/json Accept header</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#6-Conclusion"><span class="post-toc-number">6.</span> <span class="post-toc-text">6. Conclusion</span></a></li></ol>

        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script>
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').css('background-image', 'url(' + '/img/random/material-' + randomNum + '.png' + ')');
</script>

        
    
            <p class="article-headline-p">
                Http Message Converters with the Spring Framework
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>marnner</strong>
        <span>6月 23, 2017</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/spring/">spring</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    
    <!-- Leancloud Views -->
        <a class="post_share-link" href="#">
            <li class="mdl-menu__item">
                <span id="/2017/06/23/Http Message Converters with the Spring Framework/" class="leancloud-views_num" data-flag-title="Http Message Converters with the Spring Framework">
     &nbsp;浏览量
</span>

            </li>
        </a>
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=Http Message Converters with the Spring Framework&url=http://yoursite.com//2017/06/23/Http Message Converters with the Spring Framework/index.html&pic=&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=Http Message Converters with the Spring Framework&url=http://yoursite.com//2017/06/23/Http Message Converters with the Spring Framework/index.html&via=marnner" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com//2017/06/23/Http Message Converters with the Spring Framework/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://yoursite.com//2017/06/23/Http Message Converters with the Spring Framework/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h2 id="1-Overview"><a href="#1-Overview" class="headerlink" title="1. Overview"></a><strong>1. Overview</strong></h2><p>本文介绍如何在Spring中配置HttpMessageConverter。<br>简单地说，消息转换器用于通过HTTP来对Java对象进行和从JSON，XML等进行编组和解组。</p>
<h2 id="2-The-Basics"><a href="#2-The-Basics" class="headerlink" title="2. The Basics"></a><strong>2. The Basics</strong></h2><p>Web应用程序需要配置Spring MVC支持 - 一个方便且非常可定制的方法是使用@EnableWebMvc注释：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@EnableWebMvc</span></div><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="meta">@ComponentScan</span>(&#123; <span class="string">"org.baeldung.web"</span> &#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>请注意，此类扩展了WebMvcConfigurerAdapter - 这将允许我们使用我们自己的Http转换器的默认列表。</p>
<h3 id="2-2-The-Default-Message-Converters"><a href="#2-2-The-Default-Message-Converters" class="headerlink" title="2.2. The Default Message Converters"></a><strong>2.2. The Default Message Converters</strong></h3><p>默认情况下，以下HttpMessageConverters实例已预启用：</p>
<ul>
<li>ByteArrayHttpMessageConverter - 字节数组转换</li>
<li>StringHttpMessageConverter - 转换字符串</li>
<li>ResourceHttpMessageConverter - 转换任何类型的八位字节流的org.springframework.core.io.Resource</li>
<li>SourceHttpMessageConverter - 转换javax.xml.transform.Source</li>
<li>FormHttpMessageConverter - 将表单数据转换为/从MultiValueMap <string，string>转换。</string，string></li>
<li>Jaxb2RootElementHttpMessageConverter - 将Java对象转换为/从XML转换（仅在类路径中存在JAXB2时添加）</li>
<li>MappingJackson2HttpMessageConverter - 转换JSON（仅在类路径中存在Jackson 2时才添加）</li>
<li>MappingJacksonHttpMessageConverter - 转换JSON（仅当Jackson 2存在于类路径时才添加）</li>
<li>AtomFeedHttpMessageConverter - 转换Atom订阅源（仅当 Rome在类路径中存在时添加）</li>
<li>RssChannelHttpMessageConverter - RSS源（只加了，如果Rome存在的类路径上）转换</li>
</ul>
<h2 id="3-Client-Server-Communication-–-JSON-only"><a href="#3-Client-Server-Communication-–-JSON-only" class="headerlink" title="3. Client-Server Communication – JSON only"></a><strong>3. Client-Server Communication – JSON only</strong></h2><h3 id="3-1-High-Level-Content-Negotiation"><a href="#3-1-High-Level-Content-Negotiation" class="headerlink" title="3.1. High Level Content Negotiation"></a><strong>3.1. High Level Content Negotiation</strong></h3><p>每个HttpMessageConverter实现都有一个或多个关联的MIME类型。</p>
<p>当接收到新的请求时，Spring将使用“Accept”头来确定需要响应的媒体类型。</p>
<p>然后，它将尝试找到一个能够处理该特定媒体类型的注册转换器 - 它将使用它转换实体并发回响应。</p>
<p>该过程类似于接收包含JSON信息的请求 - 框架将使用“Content-Type”头来确定请求体的媒体类型。</p>
<p>然后，它将搜索可以将客户端发送的身体转换为Java对象的HttpMessageConverter。</p>
<p>让我们用一个简单的例子来阐明一下：</p>
<ul>
<li>客户端向/ foos发送一个GET请求，将Accept标头设置为application / json，以获取所有Foo资源为Json</li>
<li>Foo Spring控制器被命中并返回相应的Foo Java实体</li>
<li>然后，Spring然后使用Jackson消息转换器之一将实体编组到json</li>
</ul>
<p>现在来看看这个工作原理的具体细节，以及我们如何利用@ResponseBody和@RequestBody注释。</p>
<h3 id="3-2-ResponseBody"><a href="#3-2-ResponseBody" class="headerlink" title="3.2. @ResponseBody"></a><strong>3.2. @ResponseBody</strong></h3><p>Controller上的@ResponseBody方法向Spring表示方法的返回值直接序列化到HTTP响应的主体。如上所述，客户端指定的“Accept”标头将用于选择适当的Http Converter来组织实体。</p>
<p>我们来看一个简单的例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(method=RequestMethod.GET, value=<span class="string">"/foos/&#123;id&#125;"</span>)</div><div class="line"><span class="keyword">public</span> <span class="meta">@ResponseBody</span> <span class="function">Foo <span class="title">findById</span><span class="params">(@PathVariable <span class="keyword">long</span> id)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> fooService.get(id);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在，客户端将在request-example curl命令中指定application / json中的“Accept”标头：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">curl --<span class="selector-tag">header</span> <span class="string">"Accept: application/json"</span></div><div class="line">  http:<span class="comment">//localhost:8080/spring-rest/foos/1</span></div></pre></td></tr></table></figure>
<p>The Foo class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">long</span> id;</div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>和Http响应body：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"id"</span>: <span class="number">1</span>,</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"Paul"</span>,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3-3-RequestBody"><a href="#3-3-RequestBody" class="headerlink" title="3.3. @RequestBody"></a><strong>3.3. @RequestBody</strong></h3><p>@RequestBody是用于Controller方法的参数 - 它向Spring指出，HTTP请求的正文反序列化到该特定的Java实体。如前所述，由客户端指定的“Content-Type”头将用于确定适当的转换器。 我们来看一个例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(method=RequestMethod.PUT, value=<span class="string">"/foos/&#123;id&#125;"</span>)</div><div class="line"><span class="keyword">public</span> <span class="meta">@ResponseBody</span> <span class="function"><span class="keyword">void</span> <span class="title">updateFoo</span><span class="params">(</span></span></div><div class="line">  @RequestBody Foo foo, @PathVariable String id) &#123;</div><div class="line">    fooService.update(foo);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在，让我们用JSON对象来使用它 - 我们将“Content-Type”指定为application / json：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">curl -i -X PUT -<span class="keyword">H</span> <span class="string">"Content-Type: application/json"</span> </div><div class="line">-<span class="keyword">d</span> '&#123;<span class="string">"id"</span>:<span class="string">"83"</span>,<span class="string">"name"</span>:<span class="string">"klik"</span>&#125;' http:<span class="comment">//localhost:8080/spring-rest/foos/1</span></div></pre></td></tr></table></figure>
<p>我们得到200 OK - 一个成功的回应：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">HTTP/1.1 <span class="number">200</span> OK</div><div class="line"><span class="attribute">Server</span>: Apache-Coyote/1.1</div><div class="line"><span class="attribute">Content-Length</span>: 0</div><div class="line"><span class="attribute">Date</span>: Fri, 10 Jan 2014 11:18:54 GMT</div></pre></td></tr></table></figure>
<h2 id="4-Custom-Converters-Configuration"><a href="#4-Custom-Converters-Configuration" class="headerlink" title="4. Custom Converters Configuration"></a><strong>4. Custom Converters Configuration</strong></h2><p>我们可以通过扩展WebMvcConfigurerAdapter类并覆盖configureMessageConverters方法来自定义消息转换器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@EnableWebMvc</span></div><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="meta">@ComponentScan</span>(&#123; <span class="string">"org.baeldung.web"</span> &#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureMessageConverters</span><span class="params">(</span></span></div><div class="line">      List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) &#123;</div><div class="line">     </div><div class="line">        messageConverters.add(createXmlHttpMessageConverter());</div><div class="line">        messageConverters.add(<span class="keyword">new</span> MappingJackson2HttpMessageConverter());</div><div class="line"> </div><div class="line">        <span class="keyword">super</span>.configureMessageConverters(converters);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> HttpMessageConverter&lt;Object&gt; <span class="title">createXmlHttpMessageConverter</span><span class="params">()</span> </span>&#123;</div><div class="line">        MarshallingHttpMessageConverter xmlConverter = </div><div class="line">          <span class="keyword">new</span> MarshallingHttpMessageConverter();</div><div class="line"> </div><div class="line">        XStreamMarshaller xstreamMarshaller = <span class="keyword">new</span> XStreamMarshaller();</div><div class="line">        xmlConverter.setMarshaller(xstreamMarshaller);</div><div class="line">        xmlConverter.setUnmarshaller(xstreamMarshaller);</div><div class="line"> </div><div class="line">        <span class="keyword">return</span> xmlConverter;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里是相应的XML配置：</p>
<figure class="highlight vbscript-html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line">&lt;beans xmlns="http://www.springframework.org/schema/beans"</div><div class="line">  xmlns:mvc="http://www.springframework.org/schema/mvc"</div><div class="line">  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</div><div class="line">  xmlns:context="http://www.springframework.org/schema/context"</div><div class="line">  xsi:schemaLocation="</div><div class="line">    http://www.springframework.org/schema/beans </div><div class="line">      http://www.springframework.org/schema/beans/spring-beans.xsd </div><div class="line">    http://www.springframework.org/schema/context </div><div class="line">      http://www.springframework.org/schema/context/spring-context.xsd </div><div class="line">    http://www.springframework.org/schema/mvc </div><div class="line">      http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd"&gt;</div><div class="line"> </div><div class="line">    &lt;context:component-scan base-package="org.baeldung.web" /&gt;</div><div class="line"> </div><div class="line">    &lt;mvc:annotation-driven&gt;</div><div class="line">        &lt;mvc:message-converters&gt;</div><div class="line">           &lt;bean</div><div class="line">             class="org.springframework.http.converter.json.MappingJackson2HttpMessageConverter"/&gt;</div><div class="line">              </div><div class="line">           &lt;bean class="org.springframework.http.converter.xml.MarshallingHttpMessageConverter"&gt;</div><div class="line">               &lt;property name="marshaller" ref="xstreamMarshaller" /&gt;</div><div class="line">               &lt;property name="unmarshaller" ref="xstreamMarshaller" /&gt;</div><div class="line">           &lt;/bean&gt; </div><div class="line">        &lt;/mvc:message-converters&gt;</div><div class="line">    &lt;/mvc:annotation-driven&gt;</div><div class="line">     </div><div class="line">    &lt;bean id="xstreamMarshaller" class="org.springframework.oxm.xstream.XStreamMarshaller" /&gt;</div><div class="line"> </div><div class="line">&lt;/beans&gt;</div></pre></td></tr></table></figure>
<p>请注意，XStream库现在需要存在于类路径中。</p>
<p>还要注意，通过扩展这个支持类，我们正在丢失以前预先注册的默认消息转换器 - 我们只有我们定义的。</p>
<p>我们来看一下这个例子 - 我们正在创建一个新的转换器–MarshallingHttpMessageConverter，我们使用Spring XStream支持来配置它。因为我们使用底层编组框架的低级API（在这种情况下是XStream），因此我们可以非常灵活地进行配置，但是我们可以配置这些。</p>
<p>我们当然可以为Jackson做同样的事情 - 通过定义我们自己的MappingJackson2HttpMessageConverter，我们现在可以在此转换器上设置一个自定义的ObjectMapper，并根据需要进行配置。</p>
<p>在这种情况下，XStream是选定的编组器/解组器实现，但是可以使用其他类似CastorMarshaller的方法来引用Spring api文档，以获取可用编组器的完整列表。 在这一点上 - 在后端启用了XML - 我们可以使用XML表示形式使用API​​：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">curl --<span class="selector-tag">header</span> <span class="string">"Accept: application/xml"</span></div><div class="line">  http:<span class="comment">//localhost:8080/spring-rest/foos/1</span></div></pre></td></tr></table></figure>
<h2 id="5-Using-Spring’s-RestTemplate-with-Http-Message-Converters"><a href="#5-Using-Spring’s-RestTemplate-with-Http-Message-Converters" class="headerlink" title="5. Using Spring’s RestTemplate with Http Message Converters"></a><strong>5. Using Spring’s RestTemplate with Http Message Converters</strong></h2><p>除了服务器端，Http消息转换可以在客户端在Spring RestTemplate上进行配置。</p>
<p>我们将在适当的时候使用“Accept”和“Content-Type”标头来配置模板，我们将尝试使用完整的编组和解组Foo资源来消费REST API，包括JSON和XML 。</p>
<h3 id="5-1-Retrieving-the-Resource-with-no-Accept-Header"><a href="#5-1-Retrieving-the-Resource-with-no-Accept-Header" class="headerlink" title="5.1. Retrieving the Resource with no Accept Header"></a><strong>5.1. Retrieving the Resource with no Accept Header</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetFoo</span><span class="params">()</span> </span>&#123;</div><div class="line">    String URI = “http:<span class="comment">//localhost:8080/spring-rest/foos/&#123;id&#125;";</span></div><div class="line">    RestTemplate restTemplate = <span class="keyword">new</span> RestTemplate();</div><div class="line">    Foo foo = restTemplate.getForObject(URI, Foo.class, <span class="string">"1"</span>);</div><div class="line">    Assert.assertEquals(<span class="keyword">new</span> Integer(<span class="number">1</span>), foo.getId());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="5-3-Retrieving-a-Resource-with-application-json-Accept-header"><a href="#5-3-Retrieving-a-Resource-with-application-json-Accept-header" class="headerlink" title="5.3. Retrieving a Resource with application/json Accept header"></a><strong>5.3. Retrieving a Resource with application/json Accept header</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">givenConsumingJson_whenReadingTheFoo_thenCorrect</span><span class="params">()</span> </span>&#123;</div><div class="line">    String URI = BASE_URI + <span class="string">"foos/&#123;id&#125;"</span>;</div><div class="line"> </div><div class="line">    RestTemplate restTemplate = <span class="keyword">new</span> RestTemplate();</div><div class="line">    restTemplate.setMessageConverters(getMessageConverters());</div><div class="line"> </div><div class="line">    HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();</div><div class="line">    headers.setAccept(Arrays.asList(MediaType.APPLICATION_JSON));</div><div class="line">    HttpEntity&lt;String&gt; entity = <span class="keyword">new</span> HttpEntity&lt;String&gt;(headers);</div><div class="line"> </div><div class="line">    ResponseEntity&lt;Foo&gt; response = </div><div class="line">      restTemplate.exchange(URI, HttpMethod.GET, entity, Foo.class, <span class="string">"1"</span>);</div><div class="line">    Foo resource = response.getBody();</div><div class="line"> </div><div class="line">    assertThat(resource, notNullValue());</div><div class="line">&#125;</div><div class="line"><span class="keyword">private</span> List&lt;HttpMessageConverter&lt;?&gt;&gt; getMessageConverters() &#123;</div><div class="line">    List&lt;HttpMessageConverter&lt;?&gt;&gt; converters = </div><div class="line">      <span class="keyword">new</span> ArrayList&lt;HttpMessageConverter&lt;?&gt;&gt;();</div><div class="line">    converters.add(<span class="keyword">new</span> MappingJackson2HttpMessageConverter());</div><div class="line">    <span class="keyword">return</span> converters;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="6-Conclusion"><a href="#6-Conclusion" class="headerlink" title="6. Conclusion"></a><strong>6. Conclusion</strong></h2><p>在本教程中，我们研究了Spring MVC如何使我们能够指定和完全自定义Http消息转换器来自动将Java实体与XML或JSON进行编组/解组。这当然是一个简单的定义，消息转换机制可以做得更多，从上一个测试示例可以看出。</p>
<p>我们还研究了如何利用与RestTemplate客户端相同的强大机制 - 导致完全类型安全的消费API</p>

    

    
</div>


                

                <!-- Post Comments -->
                
                    




                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2017/06/23/Spring MVC and the @ModelAttribute Annotation/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2017/06/23/A Guide to the ViewResolver in Spring MVC/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="marnner's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        marnner@email.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="marnner@qq.com" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/" target="_self">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2017/06/">六月 2017<span class="sidebar_archives-count">30</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">五月 2017<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/04/">四月 2017<span class="sidebar_archives-count">7</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">三月 2017<span class="sidebar_archives-count">11</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                
            </ul>
        </li>
        
            <li class="divider"></li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/about" title="关于">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                关于
            </a>
        </li>
        
    
        <li>
            <a href="/tags" title="标签">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                标签
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                文章总数
                <span class="sidebar-badge">54</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            主题 - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    
    <span id="footer-image">
        <a href="https://www.upyun.com/" target="_blank" title="upyun_logo">
            <img src="/img/upyun_logo.png" alt="upyun_logo">
        </a>
    </span>


</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/twitter" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-twitter.png);">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/facebook" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-facebook.png);">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    
        <a href="https://www.google.com/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-gplus.png);">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;
            <script type="text/javascript">
                var fd = new Date();
                document.write(fd.getFullYear());
            </script>
            &nbsp;Marnner
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->
<script src="/js/lazyload.min.js"></script>
<script src="/js/js.min.js"></script>
<script src="/js/nprogress.js"></script>

<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>





    <!-- Leancloud -->
    <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
    <script>
        AV.initialize('OoSlDSbIliFRAyiYasybSCBF-gzGzoHsz', 'wBoYp7LTE4ztlVNlSlVyd3by');
    </script>
    <script>
    function showTime(Counter) {
        var query = new AV.Query(Counter);
        $('.leancloud-views_num').each(function() {
            var url = $(this).attr('id').trim();
            query.equalTo('url', url);
            query.find({
                success: function(results) {
                    if (results.length === 0) {
                        var content = '0 ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                        return;
                    }
                    for (var i = 0; i < results.length; i++) {
                        var object = results[i];
                        var content = object.get('time') + ' ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                    }
                },
                error: function(object, error) {
                    console.log('Error: ' + error.code + ' ' + error.message);
                }
            });
        });
    }

    function addCount(Counter) {
      var Counter = AV.Object.extend('Counter');
      url = $('.leancloud-views_num').attr('id').trim();
      title = $('.leancloud-views_num').attr('data-flag-title').trim();
      var query = new AV.Query(Counter);
      query.equalTo('url', url);
      query.find({
          success: function(results) {
            if (results.length > 0) {
                var counter = results[0];
                counter.fetchWhenSave(true);
                counter.increment('time');
                counter.save(null, {
                    success: function(counter) {
                        var content =  counter.get('time') + ' ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                    },
                    error: function(counter, error) {
                        console.log('Failed to save Visitor num, with error message: ' + error.message);
                    }
                });
            } else {
              var newcounter = new Counter();
              newcounter.set('title', title);
              newcounter.set('url', url);
              newcounter.set('time', 1);
              newcounter.save(null, {
                  success: function(newcounter) {
                      console.log('newcounter.get(\'time\')='+newcounter.get('time'));
                      var content = newcounter.get('time') + ' ' + $(document.getElementById(url)).text();
                      $(document.getElementById(url)).text(content);
                  },
                  error: function(newcounter, error) {
                      console.log('Failed to create');
                  }
              });
            }
        },
        error: function(error) {
            console.log('Error:' + error.code + ' ' + error.message);
        }
      });
    }
    $(function() {
        var Counter = AV.Object.extend('Counter');
        if ($('.leancloud-views_num').length === 1) {
            addCount(Counter);
        } else if ($('.post-title-link').length > 1) {
            showTime(Counter);
        }
    });
</script>










<!-- Swiftye -->


<!-- Local Search-->


<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->


                </main>
            </div>
        </body>
    
</html>
